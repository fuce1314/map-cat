/**/ï»¿_jsload&&_jsload('menu', 'ev.extend(gE.prototype,{initialize:function(e){if(this._container){return false}this._map=e;this._render();var jj=this;this._container.style.cursor=e.config.defaultCursor;ev.on(document,"mousedown",function(i){if(!jj._container){return}jj.hide()});ev.on(this._container,"mousemove",ad);ev.on(this._container,"click",function(i){jj.hide();ad(i)});var ji=this._opts.container;if(!ji){ji=this._map.container;e.addEventListener("onspotmouseover",function(i){jj.spots=i.spots});var T;e.addEventListener("onspotmouseout",function(i){T=i.spots;delete jj.spots});e.addEventListener("onspotclick",function(i){jj.spots=i.spots});e.addEventListener("rightclickex",function(jp){if(this.getMapType()===BMAP_EARTH_MAP){return}if(!jj._container||jp.infoWindow||!jj._enable){return}if(e.currentOperation!==dL.idle){return}if(!jj.spots&&T&&T.length>0){var jr=jp.pixel;var jq=T[0];var jo=jq.pt;var i=this.pointToPixelIn(jo);var jn=jq.bd;if(jr.x-i.x<jn[2]&&jr.x-i.x>jn[0]&&i.y-jr.y<jn[3]&&i.y-jr.y>jn[1]){jj.spots=T}}jj._showMenu(jp,ji);delete jj.spots});e.addEventListener("forcedown",function(jp){if(this.getMapType()===BMAP_EARTH_MAP){return}if(!jj._container||jp.infoWindow||!jj._enable){return}if(!jj.spots&&T&&T.length>0){var jr=jp.pixel;var jq=T[0];var jo=jq.pt;var i=this.pointToPixelIn(jo);var jn=jq.bd;if(jr.x-i.x<jn[2]&&jr.x-i.x>jn[0]&&i.y-jr.y<jn[3]&&i.y-jr.y>jn[1]){jj.spots=T}}jj._showMenu(jp,ji);delete jj.spots})}else{ev.on(ji,"contextmenu",function(jn){if(e.getMapType()===BMAP_EARTH_MAP){return}if(e.currentOperation!==dL.idle){return}if(!jj._container||!jj._enable){return}jn=window.event||jn;var i=jn.target||jn.srcElement;while(i&&!ev.hc(i,"pop")){i=i.parentNode}if(i&&ev.hc(i,"pop")){jj.hide();return}jj._showMenu(jn,ji,true);return b(jn)})}var jl=[];for(var jg=this._items.length-1;jg>=0;jg--){var jm=this._items[jg];if(jm._insertIndex!==-1){jl=jl.concat(this._items.splice(jg,1))}}for(var jg=0,je=this._items.length;jg<je;jg++){var jm=this._items[jg];if(jm._type==="menuitem"){jm.initialize(e,this)}if(jm._type==="divider"){this._dividers[jm._dIndex].dom=bB(this._container,"<div class=\'BMap_cmDivider\'></div>")}}for(var jg=jl.length-1;jg>=0;jg--){var jm=jl[jg];if(jm._type==="menuitem"){jm.initialize(e,this)}if(jm._type==="divider"){for(var jf=0,jk=this._items.length;jf<jk;jf++){if(jf===jm._insertIndex){var jh=this._items[jf]._container||this._dividers[this._items[jf]._dIndex].dom;this._dividers[jm._dIndex].dom=fe(jh,"<div class=\'BMap_cmDivider\'></div>");break}}}}for(var jg=jl.length-1;jg>=0;jg--){var jm=jl[jg];this._items.splice(jm._insertIndex,0,jm)}this._updateShadowSize()},_draw:function(){if(this._map){this.initialize(this._map);if(this._isOpen){this._isOpen=false;this.show()}}},remove:function(){if(this._container){this._container.parentNode.removeChild(this._container);this._container=null}this._map=null},_render:function(){this._container=bB(this._map.container,"<div unselectable=\'on\'></div>");this._container.className="BMap_contextMenu";this._container.style.fontSize="12px";return this._container},addItem:function(jf,e){if(!jf||jf._type!="menuitem"||jf._text==""||jf._width<=0){return}for(var je=0,T=this._items.length;je<T;je++){if(this._items[je]===jf){return}}if(e===undefined||e>this._items.length-1){e=-1}jf._insertIndex=e;jf.initialize(this._map,this);if(e===-1){this._items.push(jf);this._rItems.push(jf)}else{this._items.splice(e,0,jf);this._rItems.splice(e,0,jf)}ev.ac(jf.getDom(),"BMap_cmLstItem");if(this._items.length>1){this._items[this._items.length-2]._type=="menuitem"&&ev.rc(this._items[this._items.length-2].getDom(),"BMap_cmLstItem")}else{this._items[0]._type=="menuitem"&&ev.ac(this._items[0].getDom(),"BMap_cmFstItem")}this._updateShadowSize()},removeItem:function(je){if(!je||je._type!="menuitem"){return}for(var T=0,e=this._items.length;T<e;T++){if(this._items[T]===je){this._items[T].remove();this._items.splice(T,1);delete je._insertIndex;e--}}for(var T=0,e=this._rItems.length;T<e;T++){if(this._rItems[T]===je){this._rItems[T].remove();this._rItems.splice(T,1);delete je._insertIndex;e--}}if(!this._container){return}if(this._items.length>0){this._items[this._items.length-1]._type=="menuitem"&&ev.ac(this._items[this._items.length-1].getDom(),"BMap_cmLstItem")}this._updateShadowSize()},addSeparator:function(e){if(e===undefined||e>this._items.length-1){e=-1}var ji={_type:"divider",_dIndex:this._dividers.length,_insertIndex:e};this._dividers.push({dom:null});if(!this._container){return}var jh="<div class=\'BMap_cmDivider\'></div>";if(e===-1){this._dividers[this._dividers.length-1].dom=bB(this._container,jh)}else{var jf=this._items;for(var jg=0,je=jf.length;jg<je;jg++){if(jg===e){var T=jf[jg]._container||this._dividers[jf[jg]._dIndex].dom;this._dividers[this._dividers.length-1].dom=fe(T,jh);break}}}if(e===-1){this._items.push(ji)}else{this._items.splice(e,0,ji)}this._updateShadowSize()},removeSeparator:function(T){if(!this._dividers[T]){return}if(this._dividers[T].dom&&this._dividers[T].dom.parentNode){this._dividers[T].dom.parentNode.removeChild(this._dividers[T].dom)}for(var je=0,e=this._items.length;je<e;je++){if(this._items[je]&&this._items[je]._type=="divider"&&this._items[je]._dIndex==T){this._items.splice(je,1);e--}if(this._items[je]&&this._items[je]._type=="divider"&&this._items[je]._dIndex>T){this._items[je]._dIndex--}}this._dividers.splice(T,1);this._updateShadowSize()},setPosition:function(e,i){this._left=e;this._top=i;this._container.style.left=e+"px";this._container.style.top=i+"px"},show:function(){if(this._isOpen==true){return}if(this._rItems.length==0){return}this._isOpen=true;if(this._container){this._container.style.visibility="visible"}var e=new fa("onopen");e.point=this.curPoint;e.pixel=this.curPixel;this.dispatchEvent(e)},hide:function(){if(this._isOpen==false){return}this._isOpen=false;if(this._container){this._container.style.visibility="hidden"}var e=new fa("onclose");e.point=this.curPoint;e.pixel=this.curPixel;this.dispatchEvent(e)},setCursor:function(e){if(!e){return}this._opts.cursor=e;if(this._container){this._container.style.cursor=this._opts.cursor}},_updateShadowSize:function(){if(this._container){this._container.offsetWidth+"px";this._container.offsetHeight+"px"}},_showMenu:function(jg,jj,ji){if(this._rItems.length==0){return}var jk=this;var jm=jg.layerX||jg.offsetX;var jl=jg.layerY||jg.offsetY;var jo=jg.target||jg.srcElement;if(ji){var jh=jo;if(jj==jk._map.container&&jh!==jk._map.maskLayer&&jh.nodeName.toLowerCase()!="svg"){while(jh&&!ev.hc(jh,"shadow")){jh=jh.parentNode}if(!ev.hc(jh,"shadow")||jh.getAttribute("type")!="infowindow_shadow"){jk.hide();return}}while(jo&&jo!=jk._map.container){if(!(jo.clientWidth==0&&jo.clientHeight==0&&jo.offsetParent&&jo.offsetParent.nodeName.toLowerCase()=="td")){if(jo.nodeName.toLowerCase()=="svg"){jm+=parseInt(jo.getAttribute("viewBox").split(" ")[0])||0;jl+=parseInt(jo.getAttribute("viewBox").split(" ")[1])||0}else{jm+=jo.offsetLeft;jl+=jo.offsetTop}}jo=jo.offsetParent||jo.parentNode}jk.curPixel=new eO(jm,jl)}else{jk.curPixel=jg.pixel}if(this.spots&&this.spots.length>0){var jf=this.spots[0];var jp=jf.userdata.iconPoint;jk.curPoint=jp;jk.curPixel=jk._map.pointToPixelIn(jp)}else{if(jg.overlay&&jg.overlay instanceof iU){jk.curPoint=jg.overlay.getPoint();jk.curPixel=jk._map.pointToPixelIn(jk.curPoint)}else{jk.curPoint=jk._map.pixelToPointIn(jk.curPixel)}}if(jk.curPoint.lng<dR[jk._map.mapType].bounds[0]||jk.curPoint.lng>dR[jk._map.mapType].bounds[2]||jk.curPoint.lat<dR[jk._map.mapType].bounds[1]||jk.curPoint.lat>dR[jk._map.mapType].bounds[3]){return}var je=jk.getDom().offsetHeight;var jn=jk.getDom().offsetWidth;var T=jg.offsetX;var i=jg.offsetY;if(ji){T=jm;i=jl}if(jg.offsetX+jn>this._map.width){T-=jn}if(jg.offsetY+je>this._map.height){i-=je}jk.setPosition(T,i);jk.show()}});ev.extend(hd.prototype,{initialize:function(e,i){if(this._container){return false}this._map=e;this._contextmenu=i;if(i.getDom()){this._render();this._bind();if(!this._enabled){this._enabled=true;this.disable()}}return true},remove:function(){var e=this;if(this._container){this._container.parentNode.removeChild(this._container);this._container=null}this._contextmenu=null;this._map=null},_draw:function(){if(this._contextmenu&&this._map){this.initialize(this._map,this._contextmenu)}},_render:function(){var jg="<div"+(this._opts.id?" id=\'"+this._opts.id+"\'":"")+" unselectable=\'on\'><span>"+this._text+"</span></div>";var jk=this._insertIndex;var jf=this._contextmenu.getDom();var jh=this._contextmenu._items;var T=this._contextmenu._dividers;if(jk===-1){this._container=bB(jf,jg)}else{for(var je=0,e=jh.length;je<e;je++){if(je===jk){var ji=jh[je]._container||T[jh[je]._dIndex].dom;this._container=fe(ji,jg);break}}}jf.style.borderRadius="4px";var jj=this._container.style;jj.padding="8px 8px";jj.MozUserSelect="none";jj.lineHeight="22px";jj.width=this._opts.width+"px";if(this._enabled){jj.color="#656565";jj.cursor="pointer"}else{jj.color="#aaa";jj.cursor=this._map.config.defaultCursor}return this._container},_bind:function(){var e=this;ev.on(this._container,"click",function(i){if(!e._enabled){ad(i);return}if(e._callback&&e._callback.call){var T=ig.convertMC2LL(e._contextmenu.curPoint);e._callback.call(e,T,e._contextmenu.curPixel)}});ev.on(this._container,"mousedown",function(i){ad(i)});ev.on(this._container,"mouseover",function(){if(!e._enabled){return}e._container.style.color="#3385ff";e._container.style.backgroundColor="#F0F8FF"});ev.on(this._container,"mouseout",function(){if(!e._enabled){return}e._container.style.color="#656565";e._container.style.backgroundColor="#fff"})},setText:function(e){if(!e){return}this._text=e+"";if(this._container){this._container.innerHTML="<span>"+this._text+"</span>"}},enable:function(){this._enabled=true;if(this._container){this._container.style.color="#656565";this._container.style.cursor="pointer"}},disable:function(){this._enabled=false;if(this._container){this._container.style.color="#aaa";this._container.style.cursor=this._map.config.defaultCursor}}});');
