/**/ï»¿_jsload&&_jsload('poly', 'hL.DOM_ATTRS={strokecolor:1,strokeweight:1,strokeopacity:1,fillcolor:1,fillopacity:1,strokelinecap:1,strokelinejoin:1,strokestyle:1,topfillcolor:1,topfillopacity:1,sidefillcolor:1,sidefillopacity:1};ev.extend(hL.prototype,{initialize:function(T){if(T&&this._graphMouseEvent){T.addEventListener("onmousemove",this._graphMouseEvent)}if(T&&this._graphClickEvent){T.addEventListener("onclick",this._graphClickEvent);T.addEventListener("ondblclick",this._graphClickEvent);T.addEventListener("onrightclick",this._graphClickEvent);T.addEventListener("onrightdblclick",this._graphClickEvent)}if((this._config.strokeStyle==="dashed"||this._config.strokeStyle==="dotted")&&T.getRenderType()==="webgl"&&!this._config.texture){this._generateTexture()}var e=d9.prototype.initialize.call(this,T);if(this._config.enableEditing===true&&!this._config.geodesic){var i=this;setTimeout(function(){i.clearVertexs();i.addVertexs()},0)}return e},_generateTexture:function(){var jg=this._config;var T=jg.dashArray;var jf=document.createElement("canvas");var e;var je;if(jg.strokeStyle==="dashed"){e=16;je=e*8}else{if(jg.strokeStyle==="dotted"){e=32;je=e*2}}jf.width=e;jf.height=je;var i=jf.getContext("2d");i.fillStyle=jg.strokeColor;i.globalAlpha=jg.strokeOpacity;if(jg.strokeStyle==="dashed"){this._drawDashArrayTexture(i,e,je)}else{if(jg.strokeStyle==="dotted"){this._drawDottedTexture(i,e,je)}}this._config.texture=jf;this._config.textureSize=[e,je]},_drawDashArrayTexture:function(jk,je,jg){var T=this._config;var ji=T.dashArray;if(!ji){jk.fillRect(0,0,je,jg/2);this._totalDashLen=T.strokeWeight*4}else{var jj=0;if(ji.length%2!==0){ji=ji.concat(ji)}for(var jf=0;jf<ji.length;jf++){jj+=ji[jf]}var e=0;for(var jf=0;jf<ji.length;jf++){var jh=ji[jf]/jj*jg;if(jf%2===0){jk.fillRect(0,e,je,jh)}e+=jh}this._totalDashLen=jj}},_drawDottedTexture:function(i,e,T){i.beginPath();i.arc(e/2,e/2,e/2,0,2*Math.PI);i.fill();i.closePath();this._totalDashLen=this._config.strokeWeight*2},_addDom:function(){if(this.map._renderType==="webgl"){return}var e=this._drawer=fm.getDrawer(this.map);this.domElement=e.addLine()},_bind:function(){var e=this.domElement;var je=this;function jg(jm,jk){var jj=jm.srcElement||jm.target;var ji=ge();var i=jm.pageX?jm.pageX:(jm.clientX+ji[1]);var jo=jm.pageY?jm.pageY:(jm.clientY+ji[0]);if(jm&&jk&&i&&jo&&jj){var jl=ev.I(jj.hashCode).map;var jn=ev.Dom.getOffset(jl.container);jk.pixel=new eO(i-jn.left,jo-jn.top);jk.point=jl.pixelToPointIn(jk.pixel);jk.latLng=jl.pixelToPoint(jk.pixel);return jk}else{return jk}}if(e&&fm.getDrawer(this.map).getType()!=="canvas"){ev.on(e,"click",function(i){je.dispatchEvent(jg(i,new fa("onclick").inherit(i)))});ev.on(e,"mousedown",function(i){je.dispatchEvent(jg(i,new fa("onmousedown").inherit(i)))});ev.on(e,"mouseup",function(i){je.dispatchEvent(jg(i,new fa("onmouseup").inherit(i)))});ev.on(e,"dblclick",function(i){je.dispatchEvent(jg(i,new fa("ondblclick").inherit(i)))})}e=null;if(!this._binded){this._binded=true;this.enableEventListen=true;this._graphMouseEvent=function(jl){if(!je.map){return}if(je.map.getMapType()==="B_EARTH_MAP"){return}if(je instanceof bp.PolylineMultipart||je instanceof bp.Marker3D){return}if(je.map.temp._draggingMarker){return}if(!je.enableEventListen){return}var ji;if(jl.overlay&&jl.overlay.toString()==="Marker"){if(!jl.overlay.keepWhenMousemoveOn){if(je._temp.ismouseout===false&&je._temp.ismouseover===true){je._temp.ismouseover=false;je._temp.ismouseout=true;ji=new fa("onmouseout");je.dispatchEvent(ji)}return}}var i=jl.point;var jk;if(je.toString()!=="Polyline"){jk=je._getInPnpoly(i)}else{jk=je._getProximity(i)}var jj=jk.dist;if(jj>=0&&jj<je._config.mouseOverTolerance){if(!je._temp.ismouseover){je._temp.ismouseover=true;je._temp.ismouseout=false;ji=new fa("onmouseover")}else{ji=new fa("onmousemove");je.map.platform.style.cursor=je.map.config.overlayMoveCursor}}else{if(!je._temp.ismouseout&&je._temp.ismouseover){je._temp.ismouseover=false;je._temp.ismouseout=true;ji=new fa("onmouseout");je.map.platform.style.cursor=je.map.config.defaultCursor}}if(ji){if(je.toString()!=="Polyline"&&ji.type==="onmousemove"&&je._temp.ismouseover===true&&(jj===0||jj>je._config.mouseOverTolerance)){ji.pixel=jl.pixel;ji.point=jl.point;ji.latLng=this.overlayPixelToPoint(jl.pixel)}else{ji.point=this.overlayPixelToPointIn(jk.pixel);ji.pixel=this.pointToPixelIn(ji.point);ji.latLng=this.overlayPixelToPoint(jk.pixel)}je.dispatchEvent(ji)}};this._graphClickEvent=function(jl){if(!je.map){return}if(je.map.getMapType()==="B_EARTH_MAP"){return}if(je instanceof bp.PolylineMultipart||je instanceof bp.Marker3D){return}if(je.map.temp._draggingMarker){return}if(!je.enableEventListen){return}var ji;var i=jl.point;var jk;if(je.toString()!=="Polyline"){jk=je._getInPnpoly(i)}else{jk=je._getProximity(i)}var jj=jk.dist;if(jj>=0&&jj<je._config.mouseOverTolerance){ji=new fa(jl.type)}if(ji){if(je.toString()!=="Polyline"&&ji.type==="onmousemove"&&je._temp.ismouseover===true&&(jj===0||jj>je._config.mouseOverTolerance)){ji.pixel=jl.pixel;ji.point=jl.point;ji.latLng=this.overlayPixelToPoint(jl.pixel)}else{ji.point=this.overlayPixelToPointIn(jk.pixel);ji.pixel=this.pointToPixelIn(ji.point);ji.latLng=this.overlayPixelToPoint(jk.pixel);if(je.toString()==="GroundOverlay"&&je.canPixelMap&&je.canPixelMap()){ji.color=je.getImagePixel(ji.point);ji.value=je.getValue(ji.color)}}je.dispatchEvent(ji)}};this.map.addEventListener("onmousemove",this._graphMouseEvent);var jf=["onclick","dblclick","onrightclick","onrightdblclick"];for(var T=0;T<jf.length;T++){var jh=jf[T];this.map.addEventListener(jh,this._graphClickEvent)}this.addEventListener("mouseover",function(i){if(!this.map){return}});this.addEventListener("mouseout",function(i){if(!this.map){return}});this.map.addEventListener("movestart",function(){je.enableEventListen=false;je._mouseEventPixels=null});this.map.addEventListener("moveend",function(){je.enableEventListen=true});this.map.addEventListener("zoomstart",function(){je.enableEventListen=false;je._mouseEventPixels=null});this.map.addEventListener("zoomend",function(){je.enableEventListen=true});this.map.on("center_changed",function(){je._mouseEventPixels=null});this.map.on("zoom_changed",function(){je._mouseEventPixels=null});this.map.on("load",function(){je._mouseEventPixels=null})}},draw:function(jf){if(!this.domElement){return}var je=this.map;if(je.getMapType()==="B_EARTH_MAP"||je._renderType==="webgl"){return}jf=jf||{};var T=this.points.slice(0);if(this.greatCirclePoints.length>0){T[0]=this.greatCirclePoints}var i=this._getDisplayPixels(T,jf.zoom,jf.center);if(this._drawer){this._drawer.setPath(this.domElement,i)}},_draw:function(){if(this.map){this.initialize(this.map);if(this.domElement){this.domElement.style.WebkitUserSelect="none"}this.draw()}},_getDisplayPixels:function(ji,jj,e){var je=this.map;var jh=[];if(ji.length==0||!this.isVisible()){return[jh]}if(je._renderType!=="webgl"&&!this.domElement){return[jh]}var T=ji;if(!this._config.enableEditing&&this._config.enableParse){T=this._simplification(ji)}var jg=[];if(ji[0] instanceof cf){var jk=this._toOverlayPixels(T,jj,e);jg.push(jk.pixels);jg.isOnBack=jk.isOnBack}else{jg.isOnBack=false;for(var jf=0;jf<T.length;jf++){var jk=this._toOverlayPixels(T[jf],jj,e);jg.push(jk.pixels);if(jk.isOnBack===true){jg.isOnBack=true}}}return jg},_toOverlayPixels:function(jj,jm,e){var T=this.map;var jk;var jl=[];var ji=T.pointToOverlayPixelIn(jj[0],{zoom:jm,center:e});jl.push(ji);if(ji.onBack){jk=true}for(var jg=1,jf=1,je=jj.length;jg<je;jg++){var jh=T.pointToOverlayPixelIn(jj[jg],{zoom:jm,center:e});if(jh.onBack){jk=true}if(!jh.equals(jl[jf-1])){jl.push(jh);jf++}}return{pixels:jl,isOnBack:jk}},getParseCacheIndex:function(e){e=Math.floor(e);if(this._config.getParseCacheIndex){return this._config.getParseCacheIndex(e)}if(e<6){return 0}if(e<10){return 1}if(e<15){return 2}return 3},getParseTolerance:function(i,e){if(e===2){e=1}i=Math.floor(i);if(this._config.getParseTolerance){return this._config.getParseTolerance(i,e)}return hL.parseTolerance[e][this.getParseCacheIndex(i)]},setPoints:function(i){this._clearCache();this.points=hL.getGraphPoints(i).slice(0);if(this.toString()==="GroundOverlay"&&this.updatePixelMc){this.updatePixelMc()}this._calcBounds();this.draw();var e=new fa("onlineupdate");e.overlay=this;this.dispatchEvent(e);if(this._visible&&this._config.enableEditing===true&&!this._config.geodesic){this.clearVertexs();this.addVertexs()}},setPointAt:function(T,e){if(!e||!this.points[T]){return}this._clearCache();this.points[T]=new cf(e.lng,e.lat);this._calcBounds();this.draw();var i=new fa("onlineupdate");i.overlay=this;this.dispatchEvent(i)},setPositionAt:function(i,e){if(!e||!this.points[i]){return}var T=ig.convertLL2MC(e);this.setPointAt(i,T);if(this._config.enableEditing===true&&!this._config.geodesic){this.clearVertexs();this.addVertexs()}},setOptions:function(i){i=i||{};var T=this.isStyleUseTexture();for(var e in i){if(i.hasOwnProperty(e)){var jf=this._config[e];var je=i[e];this._config[e]=je;if(je!==jf&&(e==="strokeColor"||e==="strokeOpacity"||e==="strokeWeight")){if(this._config.texture){this._config.texture=null}if(T){this._generateTexture()}}if(this.map){this._setDomAttribute(e.toLowerCase(),i[e])}}}},isStyleUseTexture:function(){if(!this.map){return false}if(this.map.getRenderType()!=="webgl"){return false}return this._config.strokeStyle==="dashed"||this._config.strokeStyle==="dotted"},setStrokeColor:function(e){this.setOptions({strokeColor:e})},setStrokeLineCap:function(e){if(this._config){this._config.strokeLineCap=e}this._setDomAttribute("strokelinecap",e)},setStrokeLineJoin:function(e){if(this._config){this._config.strokeLineJoin=e}this._setDomAttribute("strokelinejoin",e)},setStrokeWeight:function(e){if(e>0){this._config.strokeWeight=e;if(!this.map){return}this._setDomAttribute("strokeweight",e)}},setStrokeOpacity:function(e){if(!e||e>1||e<0){return}this._config.strokeOpacity=e;if(!this.map){return}this._setDomAttribute("strokeopacity",e)},setFillOpacity:function(e){if(e>1||e<0){return}this._config.fillOpacity=e;this._setDomAttribute("fillopacity",e)},setStrokeStyle:function(e){if(e!="solid"&&e!="dashed"&&e!="dotted"){return}this._config.strokeStyle=e;this._setDomAttribute("strokestyle",e)},setFillColor:function(e){this._config.fillColor=e||"";this._setDomAttribute("fillcolor",e)},_setDomAttribute:function(i,T){if(!hL.DOM_ATTRS[i]){return}if(this._drawer){if(T===false||T===null||typeof T==="undefined"){T=""}this._drawer.setAttribute(this.domElement,i,T,this._config)}var e=new fa("onlineupdate");e.overlay=this;this.dispatchEvent(e);if(i==="strokeweight"&&this.getStrokeStyle()==="dashed"&&fm.getDrawer(this.map)&&fm.getDrawer(this.map).getType()==="svg"){this._setDomAttribute("strokestyle","dashed")}},addVertexs:function(){var ji=this;if(ji.vertexMarkers.length){return}var jj=this.getVertexPoints();var jh;for(var jg=0,je=jj.length;jg<je;jg++){var e=jj[jg];if(e.t){if(this._config.nodeT&&this._config.nodeT instanceof iy){var T=this._config.nodeT}else{jh=w.imgPath+"nodeT.gif";var T=new iy(jh,new h8(11,11),{offset:new h8(5,5)})}}else{if(this._config.node&&this._config.node instanceof iy){var T=this._config.node}else{jh=w.imgPath+"node.gif";var T=new iy(jh,new h8(11,11),{offset:new h8(5,5)})}}var jf=new iU(e.p,{icon:T});jf.enableDragging(true);jf.addEventListener("ondragging",function(i){ji._onMarkerDragging(i)});jf.addEventListener("ondragstart",function(i){ji._onMarkerDragstart(i)});jf.addEventListener("ondragend",function(i){ji._onMarkerDragend(i)});jf.addEventListener("onmarkerdelvertex",function(i){ji._onMarkerDelVertex(i)});jf.index=jg;jf.t=e.t;this.vertexMarkers.push(jf);this.map?this.map.addOverlay(jf):""}},clearVertexs:function(){var e;while(e=this.vertexMarkers.pop()){this.map.removeOverlay(e);e=undefined}this.vertexMarkers.length=0},getVertexPoints:function(){var jg=[];for(var jf=0,T=this.points.length;jf<T;jf++){var jh=this.points[jf];jg.push({p:jh,t:0});if(jf<T-1){var e=this.points[jf+1];var je=new cf((jh.lng+e.lng)/2,(jh.lat+e.lat)/2);jg.push({p:je,t:1})}}this.vertexPoints=jg;return jg},delVertex:function(e){this.map.removeOverlay(this.vertexMarkers[e]);this.vertexPoints.splice(e,1);this.vertexMarkers.splice(e,1)},_onMarkerDragging:function(i){},_onMarkerDragstart:function(T){this._editstate=false;var i=new fa("oneditstart");i.pixel=T.pixel;i.point=T.point;i.latLng=T.latLng;i.overlay=this;this.dispatchEvent(i)},_onMarkerDragend:function(ji){this.vertexPoints.length=0;this._editstate=false;if(this._temp.dashedLine){this.map.removeOverlay(this._temp.dashedLine);delete this._temp.dashedLine}if(this._temp.preTNode){this.map.removeOverlay(this._temp.preTNode);delete this._temp.preTNode}if(this._temp.nexTNode){this.map.removeOverlay(this._temp.nexTNode);delete this._temp.nexTNode}var jh=ji.currentTarget;var jj=ji.point;var T=jh.index;var jg;if(T%2!=0){T=Math.ceil(T/2);jg=this.points.slice();var jf=this.points.length-T;var je=jg.splice(T,jf);jg[jg.length]=jj;jg=jg.concat(je)}else{T=T/2;this.points.splice(T,1,jj);if(this instanceof gB&&this.points.length-1==T){this.points.splice(0,1,jj)}jg=this.points}this.clearVertexs();this.setPoints(jg);this.addVertexs();var i=new fa("oneditend");i.pixel=ji.pixel;i.point=ji.point;i.latLng=ji.latLng;i.overlay=this;this.dispatchEvent(i);this._mouseEventPixels=null},_onMarkerDelVertex:function(jg){if(this.toString()!=="Polyline"&&this.toString()!=="Polygon"){return}if(jg.target.type===0||jg.target.t===0){var jf=[];if(this.vertexPoints.length<4&&this.toString()==="Polyline"){return}if(this.vertexPoints.length<8&&this.toString()==="Polygon"){return}if(this.toString()==="Polygon"&&(jg.target.index===0||jg.target.index===(this.vertexPoints.length-1))){this.delVertex(this.vertexPoints.length-1);this.delVertex(0)}else{this.delVertex(jg.target.index)}for(var je=0;je<this.vertexPoints.length;je++){if(this.vertexPoints[je].t===0){jf.push(this.vertexPoints[je].p)}}this.points=jf;if(this.points[0].lng===this.points[this.points.length-1].lng&&this.points[0].lat===this.points[this.points.length-1].lat){this.points.splice(this.points.length-1,1)}this.clearVertexs();this.setPoints(this.points);this.addVertexs();var T=new fa("oneditend");T.pixel=jg.pixel;T.point=jg.point;T.latLng=jg.latLng;T.overlay=this;this.dispatchEvent(T);this._mouseEventPixels=null}},_getInPnpoly:function(T){var je;var ji=[];var e=this.map.pointToOverlayPixelIn(T);if(this._mouseEventPixels){ji=this._mouseEventPixels}else{if(!(this.points[0] instanceof cf)){var jh=this._getDisplayPixels(this.points);for(var jg=0;jg<jh.length;jg++){jh[jg].push(jh[jg][0]);ji=ji.concat(jh[jg])}}else{ji=this._getDisplayPixels(this.points)[0]}this._mouseEventPixels=ji}var jf=this._pixelPnpoly(e,ji);je=jf?0:1000;return{pixel:e,dist:je}},_getProximity:function(jp){var T,jf,jq,ji,jh,jo,jn,jm=[];var jr=this.map.pointToOverlayPixelIn(jp);if(this._mouseEventPixels){jm=this._mouseEventPixels}else{jm=this._getDisplayPixels(this.points)[0];this._mouseEventPixels=jm}var ju=jm.length;if(ju>1){for(var js=1;js<ju;js++){var jk=jm[js-1];var jy=jm[js];if(!jk||!jy){continue}if(jk.x!=jy.x){var jx=(jy.y-jk.y)/(jy.x-jk.x);var jv=jy.y-jx*jy.x;jn=Math.abs(jx*jr.x+jv-jr.y)/Math.sqrt(jx*jx+1)}else{jn=Math.abs(jr.x-jy.x)}var jt=Math.pow(jy.y-jk.y,2)+Math.pow(jy.x-jk.x,2);var je=Math.pow(jy.y-jr.y,2)+Math.pow(jy.x-jr.x,2);var jw=Math.pow(jk.y-jr.y,2)+Math.pow(jk.x-jr.x,2);var jg=Math.pow(jn,2);var e=je-jg+jw-jg;if(e>jt){jn=Math.sqrt(Math.min(je,jw))}if((T==null)||(T>jn)){jf=Math.sqrt(jw-jg)/Math.sqrt(jt);jq=Math.sqrt(je-jg)/Math.sqrt(jt);T=jn;jo=js}T=Math.min(T,jn)}if(jf>1){jf=1}if(jq>1){jf=0;jq=1}var jl=jm[jo-1].x-jm[jo].x;var jj=jm[jo-1].y-jm[jo].y;ji=jm[jo-1].x-(jl*jf);jh=jm[jo-1].y-(jj*jf)}return{pixel:new eO(ji,jh),dist:T}},_pixelPnpoly:function(jf,jh){var e=jh.length;var T=0;var jg=false;for(var je=0;je<e;je++){T=(je===e-1)?0:T+1;if((jh[je].y!==jh[T].y)&&(((jf.y>=jh[je].y)&&(jf.y<jh[T].y))||((jf.y>=jh[T].y)&&(jf.y<jh[je].y)))&&(jf.x<(jh[T].x-jh[je].x)*(jf.y-jh[je].y)/(jh[T].y-jh[je].y)+jh[je].x)){jg=!jg}}return jg},getMinDistance:function(i){var e=this._getProximity(i);var T=this.map.overlayPixelToPointIn(e.pixel);return this.map.getDistanceIn(i,T)},buildVertex:function(jf,jl){var ji=[];var jm=[];var jo=this.points.slice(0);var jp=[];if(this.greatCirclePoints.length>0){jo[0]=this.greatCirclePoints}var T=hL.JOININDEX[this._config.strokeLineJoin];var jn=hL.CAPINDEX[this._config.strokeLineCap];var je=this.getStrokeColorForGL();var e=this._config.strokeWeight/2;var jh=this.map.getZoom();if(jo.length>500&&jo[0] instanceof cf){if(!jl&&this._lastResult){return this._lastResult}var jk=this._getDisplayPixelsGLWithCut(jo);for(var jg=0;jg<jk.length;jg++){if(jk[jg].length<2){continue}if(ji.length/6+jf.getVertexCount(jk[jg].length)>65536){jp.push([ji,jm]);ji=[];jm=[]}jf.buildData(jk[jg],T,jn,ji,jm,je,e)}jp.push([ji,jm]);jp.inCache=false;this._lastResult=jp;return jp}var jj=this.getParseCacheIndex(this.map.getZoom());if(jl!==true&&this._parseCacheGL[jj]){this._parseCacheGL[jj].inCache=true;return this._parseCacheGL[jj]}var jk=this._getDisplayPixelsGL(jo);for(var jg=0;jg<jk.length;jg++){if(jk[jg].length<2){continue}if(ji.length/6+jf.getVertexCount(jk[jg].length)>65536){jp.push([ji,jm]);ji=[];jm=[]}jf.buildData(jk[jg],T,jn,ji,jm,je,e)}jp.push([ji,jm]);this._parseCacheGL[jj]=jp;this._parseCacheGL[jj].cacheIndex=jj;return jp},ifInMapView:function(){if(!this.map){return false}if(this.map.getZoom()<5){return true}if(this._config.clip===false){return true}var e=this.map.getBoundsIn();return !!e.intersects(this.getBoundsIn())},_getDisplayPixelsGLWithCut:function(e){return this._getDisplayPixelsGL(e)},_getDisplayPixelsGL:function(je){var jg=this.map;var jf=[];var ji=[];jf.pointsArray=ji;if(je.length==0||!this.isVisible()){return[jf]}var jh=je;if(!this._config.enableEditing&&this._config.enableParse){jh=this._simplification(je)}var T=[];if(!this.hasMultipleParts){T[0]=this._toOverlayPixelsGL(jh)}else{for(var e=0;e<jh.length;e++){T.push(this._toOverlayPixelsGL(jh[e]))}}return T},_toOverlayPixelsGL:function(jl){var T=this.map;var jk=[];var jh=[];jk.pointsArray=jh;var e=T._polyOverlayBasePoint;var jj=[jl[0].lng-e.lng,jl[0].lat-e.lat];jk.push(jj);jh.push(jj[0],jj[1]);for(var jg=1,jf=1,je=jl.length;jg<je;jg++){var ji=[jl[jg].lng-e.lng,jl[jg].lat-e.lat];if(ji[0]!==jk[jf-1][0]||ji[1]!==jk[jf-1][1]){jk.push(ji);jh.push(ji[0],ji[1]);jf++}}return jk},getStrokeColorForGL:function(){var i=this._config.strokeOpacity;var e;e=gR.formatColorCssToRgbaArray(this._config.strokeColor,i,false);return e},show:function(){d9.prototype.show.call(this);var e=new fa("onlineupdate");e.action="show";e.overlay=this;this.dispatchEvent(e);if(this.map.getMapType()==="B_EARTH_MAP"||this.map._renderType==="webgl"){this._draw()}else{this.draw()}this._mouseEventPixels=null;if(this._config.enableEditing===true&&!this._config.geodesic){this.addVertexs()}if(this._areaCacheGL){var i=this.getParseCacheIndex(this.map.getZoom());if(this._areaCacheGL[i]){this._areaCacheGL[i]=null}this.map._overlayMgrGL._updateGraphRenderData(this,true)}},hide:function(){d9.prototype.hide.call(this);var e=new fa("onlineupdate");e.action="hide";e.overlay=this;this.dispatchEvent(e);this._mouseEventPixels=null;if(this._config.enableEditing===true&&!this._config.geodesic){this.clearVertexs()}},remove:function(){if(this.map){this.map.removeEventListener("onmousemove",this._graphMouseEvent);this.map.removeEventListener("onclick",this._graphClickEvent);this.map.removeEventListener("ondblclick",this._graphClickEvent);this.map.removeEventListener("onrightclick",this._graphClickEvent);this.map.removeEventListener("onrightdblclick",this._graphClickEvent)}d9.prototype.remove.call(this);this._clearCache();var e=new fa("onlineupdate");e.action="remove";e.overlay=this;this.fire(e);if(this._config.enableEditing===true&&!this._config.geodesic){this.clearVertexs()}}});function bi(jg,je,jn){var jk=false,ji=false,jl=false,jp=new eO(jg.x,jg.y),jo=new eO(je.x,je.y),jf=fb(jp,jn),T=fb(jo,jn),jm;var jr,jq;var jj=jn.minX,jh=jn.minY,i=jn.maxX,e=jn.maxY;do{if(jf.all==0&&T.all==0){jk=true;jl=true}else{if((jf.all&T.all)!=0){jl=true}else{if(jf.all!=0){jm=jf}else{jm=T}if(jm.top){jr=jp.x+(jo.x-jp.x)*(jh-jp.y)/(jo.y-jp.y);jq=jh}else{if(jm.bottom){jr=jp.x+(jo.x-jp.x)*(e-jp.y)/(jo.y-jp.y);jq=e}else{if(jm.right){jq=jp.y+(jo.y-jp.y)*(i-jp.x)/(jo.x-jp.x);jr=i}else{if(jm.left){jq=jp.y+(jo.y-jp.y)*(jj-jp.x)/(jo.x-jp.x);jr=jj}}}}ji=true;if(jm.all==jf.all){jp.x=Math.round(jr);jp.y=Math.round(jq);jf=fb(jp,jn)}else{jo.x=Math.round(jr);jo.y=Math.round(jq);T=fb(jo,jn)}}}}while(!jl);if(jk){return{pixel0:new eO(jp.x,jp.y),pixel1:new eO(jo.x,jo.y),clip:ji?true:false}}}function fb(i,jf){var T={top:0,bottom:0,right:0,left:0,all:0};var e=i.x,je=i.y;if(je<jf.minY){T.top=8;T.all+=T.top}else{if(je>jf.maxY){T.bottom=4;T.all+=T.bottom}}if(e>jf.maxX){T.right=2;T.all+=T.right}else{if(e<jf.minX){T.left=1;T.all+=T.left}}return T}ev.extend(fl.prototype,{initialize:function(i){hL.prototype.initialize.call(this,i);var e=this._config;this.setOptions({fillColor:"",strokeColor:e.strokeColor,strokeWeight:e.strokeWeight,strokeStyle:e.strokeStyle,strokeLineCap:e.strokeLineCap,strokeLineJoin:e.strokeLineJoin,strokeOpacity:e.strokeOpacity});return this.domElement},setPoints:function(je){this._clearCache();this.points=hL.getGraphPoints(je).slice(0);if(this._config.geodesic===true){this.greatCirclePoints.length=0;for(var T=0;T<this.points.length-1;T++){this.calcGreatCirclePoints(this.points[T],this.points[T+1])}}this._calcBounds();this.draw();var e=new fa("onlineupdate");e.overlay=this;this.dispatchEvent(e)},_getDisplayPixels:function(jr,e,jw){var jx=this.map;var jg=[];if(jr.length===0||!this.isVisible()){return[jg]}if(jx._renderType!=="webgl"&&!this.domElement){return[jg]}if(!((ev.Platform.ipad||ev.Platform.iphone||ev.Platform.android)&&jr.length>5000)&&!this._config.enableEditing){var jh=this.getParseCacheIndex(jx.getZoom());if(this._parseCache[jh]){jr=this._parseCache[jh]}else{var jj=jx.config.coordType===2?1:jx.config.coordType;var T=ds(jr,this.getParseTolerance(jx.getZoom(),jj));jr=this._parseCache[jh]=T}}var jv;var jy=jx.pointToOverlayPixelIn(jr[0],{zoom:e,center:jw});jg.push(jy);if(jy.onBack){jv=true}for(var js=1,jp=1,jo=jr.length;js<jo;js++){var jf=jx.pointToOverlayPixelIn(jr[js],{zoom:e,center:jw});if(jf.onBack){jv=true}if(!jf.equals(jg[jp-1])){jg.push(jf);jp++}}var ju=[];var jm=Math.round(jx.offsetX);var jl=Math.round(jx.offsetY);if(jx._renderType==="webgl"){jm=jl=0}var jk=jx.config.drawMargin;var ji={minX:-jm-jk,minY:-jl-jk,maxX:-jm+jk+jx.width,maxY:-jl+jk+jx.height};for(js=0,jo=jg.length-1;js<jo;js++){var jt=jg[js];var jq=jg[js+1];var je=bi(jt,jq,ji);if(je){ju.push(je)}}var jn=[[]];for(js=0,jo=ju.length;js<jo;js++){if(ju[js].clip){jn[jn.length-1].push(ju[js].pixel0);jn[jn.length-1].push(ju[js].pixel1);if(ju[js+1]&&ju[js+1].clip){jn.push([])}}else{jn[jn.length-1].push(ju[js].pixel0);if(js===ju.length-1){jn[jn.length-1].push(ju[js].pixel1)}}}jn.isOnBack=jv;return jn},_getDisplayPixelsGLWithCut:function(jp){var ju=this.map;var jg=[];if(jp.length===0||!this.isVisible()){return[jg]}if(!this._config.enableEditing){var jh=this.getParseCacheIndex(ju.getZoom());if(this._parseCache[jh]){jp=this._parseCache[jh]}else{var jj=ju.config.coordType===2?1:ju.config.coordType;var T=ds(jp,this.getParseTolerance(ju.getZoom(),jj));jp=this._parseCache[jh]=T}}var jv=ju._polyOverlayBasePoint;var e=ju.getZoomUnits();if(this._parseCacheGLRaw[jh]){jg=this._parseCacheGLRaw[jh]}else{var jw=new eO(jp[0].lng-jv.lng,jp[0].lat-jv.lat);jg.push(jw);for(var jq=1,jn=1,jm=jp.length;jq<jm;jq++){var jf=new eO(jp[jq].lng-jv.lng,jp[jq].lat-jv.lat);if(!jf.equals(jg[jn-1])){jg.push(jf);jn++}}this._parseCacheGLRaw[jh]=jg}var jt=ju.pixelToPointIn(new eO(0,ju.height));var js=[];var jk=ju.config.drawMarginGL;var ji={minX:Math.round(-jk*e+(jt.lng-jv.lng)),minY:Math.round(-jk*e+(jt.lat-jv.lat)),maxX:Math.round((jk+ju.width)*e+(jt.lng-jv.lng)),maxY:Math.round((jk+ju.height)*e+(jt.lat-jv.lat))};for(jq=0,jm=jg.length-1;jq<jm;jq++){var jr=jg[jq];var jo=jg[jq+1];var je=bi(jr,jo,ji);if(je){js.push(je)}}var jl=[[]];for(jq=0,jm=js.length;jq<jm;jq++){if(js[jq].clip){jl[jl.length-1].push([js[jq].pixel0.x,js[jq].pixel0.y]);jl[jl.length-1].push([js[jq].pixel1.x,js[jq].pixel1.y]);if(js[jq+1]&&js[jq+1].clip){jl.push([])}}else{jl[jl.length-1].push([js[jq].pixel0.x,js[jq].pixel0.y]);if(jq===js.length-1){jl[jl.length-1].push([js[jq].pixel1.x,js[jq].pixel1.y])}}}return jl},_getDisplayPixelsGL:function(jl){var T=this.map;var jk=[];if(jl.length===0||!this.isVisible()){return[jk]}if(this.greatCirclePoints.length>0){jl=this.greatCirclePoints}if(!this._config.enableEditing){var jj=this.getParseCacheIndex(T.getZoom());if(this._parseCache[jj]){jl=this._parseCache[jj]}else{var jh=T.config.coordType===2?1:T.config.coordType;var jm=ds(jl,this.getParseTolerance(T.getZoom(),jh));jl=this._parseCache[jj]=jm}}var e=T._polyOverlayBasePoint;jk.push([jl[0].lng-e.lng,jl[0].lat-e.lat]);for(var jg=1,jf=1,je=jl.length;jg<je;jg++){var ji=[jl[jg].lng-e.lng,jl[jg].lat-e.lat];if(ji[0]!==jk[jf-1][0]||ji[1]!==jk[jf-1][1]){jk.push(ji);jf++}}jk=[jk];this._addMultipleDrawPath(jk);return jk},_addMultipleDrawPath:function(T,jg,i){if(this._config.clip===true){return}var jf=this.map;jg=jg||jf.getZoom();if(jg>12&&jf.getRenderType()!=="webgl"){return}var e=i?jf.worldSize(jg):g0.WORLD_SIZE_MC;var je=T.slice(0);ev.each(je,function(jh){var ji=[];ev.each(jh,function(jj){if(jj.x){ji.push(new eO(jj.x-e,jj.y))}else{ji.push([jj[0]-e,jj[1]])}});T.push(ji)});ev.each(je,function(jh){var ji=[];ev.each(jh,function(jj){if(jj.x){ji.push(new eO(jj.x+e,jj.y))}else{ji.push([jj[0]+e,jj[1]])}});T.push(ji)})},getParsedPoints:function(){var jh=this.map;var i=this.points;var e=[];var T=this;var jg=i.slice(0);jg=[jg];if(this.greatCirclePoints.length>0){jg=[];jg[0]=this.greatCirclePoints}ev.each(jg,function(jk){var jj=jh.config.coordType===2?1:jh.config.coordType;var ji=ds(jk,T.getParseTolerance(jh.getZoom(),jj));e.push(ji)});var jf=0;if(this._bounds.sw.lng<-g0.WORLD_SIZE_MC_HALF){jf=g0.WORLD_SIZE_MC}if(this._bounds.ne.lng>g0.WORLD_SIZE_MC_HALF){jf=-g0.WORLD_SIZE_MC}if(jf===0){return e}var je=e.slice(0);ev.each(je,function(ji){var jj=[];ev.each(ji,function(jk){jj.push(new cf(jk.lng+jf,jk.lat))});e.push(jj)});return e},_onMarkerDragging:function(jk){this._editstate=true;var T=jk.currentTarget;var jm=jk.point;var jl=T.index;var i=this.vertexPoints;var jn;var ji=null;var je=null;if(jl===0){var jj=i[jl+2].p;jn=[jm,jj];ji=new cf((jj.lng+jm.lng)/2,(jj.lat+jm.lat)/2);if(this.vertexMarkers[jl+1]){this.vertexMarkers[jl+1].hide()}}else{if(jl===i.length-1){var jh=i[jl-2].p;jn=[jh,jm];ji=new cf((jh.lng+jm.lng)/2,(jh.lat+jm.lat)/2);if(this.vertexMarkers[jl-1]){this.vertexMarkers[jl-1].hide()}}else{var jh=i[jl-1].p;var jj=i[jl+1].p;jn=[jh,jm,jj];if(!T.t){jh=i[jl-2].p;jj=i[jl+2].p;jn=[jh,jm,jj];ji=new cf((jh.lng+jm.lng)/2,(jh.lat+jm.lat)/2);je=new cf((jj.lng+jm.lng)/2,(jj.lat+jm.lat)/2);if(this.vertexMarkers[jl-1]){this.vertexMarkers[jl-1].hide()}if(this.vertexMarkers[jl+1]){this.vertexMarkers[jl+1].hide()}}}}if(!this._temp.dashedLine){var jg=new fl(jn,{strokeStyle:"dashed",strokeColor:this._config.strokeColor,strokeWeight:this._config.strokeWeight,strokeOpacity:this._config.strokeOpacity});this.map.addOverlay(jg);jg.hide();this._temp.dashedLine=jg}else{this._temp.dashedLine.setPoints(jn);this._temp.dashedLine.show()}if(this._config.nodeT&&this._config.nodeT instanceof iy){var jf=this._config.nodeT}else{var jf=new iy(w.imgPath+"nodeT.gif",new h8(11,11),{offset:new h8(5,5)})}if(!this._temp.preTNode&&ji){this._temp.preTNode=new iU(ji,{icon:jf});this.map.addOverlay(this._temp.preTNode)}else{if(ji){this._temp.preTNode.setPoint(ji)}}if(!this._temp.nexTNode&&je){this._temp.nexTNode=new iU(je,{icon:jf});this.map.addOverlay(this._temp.nexTNode)}else{if(je){this._temp.nexTNode.setPoint(je)}}}});ev.extend(gb.prototype,{initialize:function(i){hL.prototype.initialize.call(this,i);var e=this._config;this.setOptions({fillColor:"",strokeColor:e.strokeColor,strokeWeight:e.strokeWeight,strokeStyle:e.strokeStyle,strokeLineCap:e.strokeLineCap,strokeLineJoin:e.strokeLineJoin,strokeOpacity:e.strokeOpacity});return this.domElement},setPoints:function(i){this._clearCache();this.points=hL.getGraphPoints(i).slice(0);this.points=this.calcBezierPoints(this.points,this._cps);this._calcBounds();this.draw();var e=new fa("onlineupdate");e.overlay=this;this.dispatchEvent(e)},_getDisplayPixels:function(jr,e,jw){var jx=this.map;var jg=[];if(jr.length===0||!this.isVisible()){return[jg]}if(jx._renderType!=="webgl"&&!this.domElement){return[jg]}if(!((ev.Platform.ipad||ev.Platform.iphone||ev.Platform.android)&&jr.length>5000)&&!this._config.enableEditing){var jh=this.getParseCacheIndex(jx.getZoom());if(this._parseCache[jh]){jr=this._parseCache[jh]}else{var jj=jx.config.coordType===2?1:jx.config.coordType;var T=ds(jr,this.getParseTolerance(jx.getZoom(),jj));jr=this._parseCache[jh]=T}}var jv;var jy=jx.pointToOverlayPixelIn(jr[0],{zoom:e,center:jw});jg.push(jy);if(jy.onBack){jv=true}for(var js=1,jp=1,jo=jr.length;js<jo;js++){var jf=jx.pointToOverlayPixelIn(jr[js],{zoom:e,center:jw});if(jf.onBack){jv=true}if(!jf.equals(jg[jp-1])){jg.push(jf);jp++}}var ju=[];var jm=Math.round(jx.offsetX);var jl=Math.round(jx.offsetY);if(jx._renderType==="webgl"){jm=jl=0}var jk=jx.config.drawMargin;var ji={minX:-jm-jk,minY:-jl-jk,maxX:-jm+jk+jx.width,maxY:-jl+jk+jx.height};for(js=0,jo=jg.length-1;js<jo;js++){var jt=jg[js];var jq=jg[js+1];var je=bi(jt,jq,ji);if(je){ju.push(je)}}var jn=[[]];for(js=0,jo=ju.length;js<jo;js++){if(ju[js].clip){jn[jn.length-1].push(ju[js].pixel0);jn[jn.length-1].push(ju[js].pixel1);if(ju[js+1]&&ju[js+1].clip){jn.push([])}}else{jn[jn.length-1].push(ju[js].pixel0);if(js===ju.length-1){jn[jn.length-1].push(ju[js].pixel1)}}}jn.isOnBack=jv;return jn},_getDisplayPixelsGLWithCut:function(jp){var ju=this.map;var jg=[];if(jp.length===0||!this.isVisible()){return[jg]}if(!this._config.enableEditing){var jh=this.getParseCacheIndex(ju.getZoom());if(this._parseCache[jh]){jp=this._parseCache[jh]}else{var jj=ju.config.coordType===2?1:ju.config.coordType;var T=ds(jp,this.getParseTolerance(ju.getZoom(),jj));jp=this._parseCache[jh]=T}}var jv=ju._polyOverlayBasePoint;var e=ju.getZoomUnits();if(this._parseCacheGLRaw[jh]){jg=this._parseCacheGLRaw[jh]}else{var jw=new eO(jp[0].lng-jv.lng,jp[0].lat-jv.lat);jg.push(jw);for(var jq=1,jn=1,jm=jp.length;jq<jm;jq++){var jf=new eO(jp[jq].lng-jv.lng,jp[jq].lat-jv.lat);if(!jf.equals(jg[jn-1])){jg.push(jf);jn++}}this._parseCacheGLRaw[jh]=jg}var jt=ju.pixelToPointIn(new eO(0,ju.height));var js=[];var jk=ju.config.drawMarginGL;var ji={minX:Math.round(-jk*e+(jt.lng-jv.lng)),minY:Math.round(-jk*e+(jt.lat-jv.lat)),maxX:Math.round((jk+ju.width)*e+(jt.lng-jv.lng)),maxY:Math.round((jk+ju.height)*e+(jt.lat-jv.lat))};for(jq=0,jm=jg.length-1;jq<jm;jq++){var jr=jg[jq];var jo=jg[jq+1];var je=bi(jr,jo,ji);if(je){js.push(je)}}var jl=[[]];for(jq=0,jm=js.length;jq<jm;jq++){if(js[jq].clip){jl[jl.length-1].push([js[jq].pixel0.x,js[jq].pixel0.y]);jl[jl.length-1].push([js[jq].pixel1.x,js[jq].pixel1.y]);if(js[jq+1]&&js[jq+1].clip){jl.push([])}}else{jl[jl.length-1].push([js[jq].pixel0.x,js[jq].pixel0.y]);if(jq===js.length-1){jl[jl.length-1].push([js[jq].pixel1.x,js[jq].pixel1.y])}}}return jl},_getDisplayPixelsGL:function(jl){var T=this.map;var jk=[];if(jl.length===0||!this.isVisible()){return[jk]}if(this.greatCirclePoints.length>0){jl=this.greatCirclePoints}if(!this._config.enableEditing){var jj=this.getParseCacheIndex(T.getZoom());if(this._parseCache[jj]){jl=this._parseCache[jj]}else{var jh=T.config.coordType===2?1:T.config.coordType;var jm=ds(jl,this.getParseTolerance(T.getZoom(),jh));jl=this._parseCache[jj]=jm}}var e=T._polyOverlayBasePoint;jk.push([jl[0].lng-e.lng,jl[0].lat-e.lat]);for(var jg=1,jf=1,je=jl.length;jg<je;jg++){var ji=[jl[jg].lng-e.lng,jl[jg].lat-e.lat];if(ji[0]!==jk[jf-1][0]||ji[1]!==jk[jf-1][1]){jk.push(ji);jf++}}jk=[jk];this._addMultipleDrawPath(jk);return jk},_addMultipleDrawPath:function(T,jg,i){if(this._config.clip===true){return}var jf=this.map;jg=jg||jf.getZoom();if(jg>12&&jf.getRenderType()!=="webgl"){return}var e=i?jf.worldSize(jg):g0.WORLD_SIZE_MC;var je=T.slice(0);ev.each(je,function(jh){var ji=[];ev.each(jh,function(jj){if(jj.x){ji.push(new eO(jj.x-e,jj.y))}else{ji.push([jj[0]-e,jj[1]])}});T.push(ji)});ev.each(je,function(jh){var ji=[];ev.each(jh,function(jj){if(jj.x){ji.push(new eO(jj.x+e,jj.y))}else{ji.push([jj[0]+e,jj[1]])}});T.push(ji)})},});ev.extend(b3.prototype,{initialize:function(T){hL.prototype.initialize.call(this,T);var i=this._config;var e={paths:i.path,isBuildingMask:i.isBuildingMask,isPoiMask:i.isPoiMask,isMapMask:i.isMapMask,showRegion:i.showRegion};T.stencil=T.stencil?Object.assign(T.stencil,e):e;return this.domElement},getFillStyleForGL:function(){var e=this._config.fillOpacity;var i=gR.formatColorCssToRgbaArray(this._config.fillColor,e);this._fillStyleInfoForGL=i.join(",");return this._fillStyleInfoForGL},buildFillVertex:function(jh){var jl=[];var jj=this.getParseCacheIndex(this.map.getZoom());if(this._areaCacheGL[jj]){return this._areaCacheGL[jj]}var jk=this._getDisplayPixelsGL(this.points);if(jk.pointsArray&&jk.pointsArray.length<3){this._areaCacheGL[jj]=[[],jl];return this._areaCacheGL[jj]}var jf;var jg=[];var je=0;for(var T=0;T<jk.length;T++){if(T>0){je+=jk[T-1].length}jf=jh(jk[T].pointsArray,null,null,je);for(var e=0,ji=jf.length;e<ji;e+=3){jl.push(jf[e],jf[e+1],jf[e+2])}jg=jg.concat(jk[T].pointsArray)}var jm=[new Float32Array(jg),new Uint16Array(jl)];this._areaCacheGL[jj]=jm;return jm}});ev.extend(dT.prototype,{setPoints:function(e){if(!e){return}this._clearCache();this.points=this._unifyArgs(e);if(this._config.geodesic===true){this.calcGreatCirclePoints(ig.convertMC2LL(this.points[0][0]),ig.convertMC2LL(this.points[0][1]))}this._calcBounds()},_getDisplayPixels:function(e,jh,je){var jg=this.map;var T=[];var i=this;var jf=e.slice(0);if(this.greatCirclePoints.length>0){jf[0]=this.greatCirclePoints}ev.each(jf,function(jj,ji){var jk=i._getEachDisplayPixels(jj,ji,jh,je);ev.each(jk,function(jl){T.push(jl)})});this._addMultipleDrawPath(T,jh,true);return T},_addMultipleDrawPath:function(T,jg,i){if(this._config.clip===true){return}var jf=this.map;jg=jg||jf.getZoom();if(jg>12&&jf.getRenderType()!=="webgl"){return}var e=i?jf.worldSize(jg):g0.WORLD_SIZE_MC;var je=T.slice(0);ev.each(je,function(jh){var ji=[];ev.each(jh,function(jj){if(jj.x){ji.push(new eO(jj.x-e,jj.y))}else{ji.push([jj[0]-e,jj[1]])}});T.push(ji)});ev.each(je,function(jh){var ji=[];ev.each(jh,function(jj){if(jj.x){ji.push(new eO(jj.x+e,jj.y))}else{ji.push([jj[0]+e,jj[1]])}});T.push(ji)})},_getDisplayPixelsGL:function(e){var T=[];var i=this;var je=e.slice(0);if(this.greatCirclePoints.length>0){je[0]=this.greatCirclePoints}ev.each(je,function(jg,jf){var jh=i._getEachDisplayPixelsGL(jg,jf);ev.each(jh,function(ji){T.push(ji)})});this._addMultipleDrawPath(T);return T},_getEachDisplayPixels:function(jo,ji,jh,jl){var e=this.map;var jn=[];if(jo.length===0||!this.domElement||!this.isVisible()){return[jn]}jo=this._simplification(jo,ji);var jm;var jk=e.pointToOverlayPixelIn(jo[0],{zoom:jh,center:jl});jn.push(jk);if(jk.onBack){jm=true}for(var jg=1,je=1,T=jo.length;jg<T;jg++){var jj=e.pointToOverlayPixelIn(jo[jg],{zoom:jh,center:jl});if(jj.onBack){jm=true}if(!jj.equals(jn[je-1])){jn.push(jj);je++}}if(e.getZoom()<5||this._config.clip===false){return[jn]}var jf=this._clipLine(jn);jf.isOnBack=jm;return jf},_simplification:function(je,T){if(this._config.enableEditing){return je}var jg=this.map;var jf=this.getParseCacheIndex(jg.getZoom());if(this._parseCache[jf]&&this._parseCache[jf][T]){return this._parseCache[jf][T]}else{var i=jg.config.coordType===2?1:jg.config.coordType;var e=ds(je,this.getParseTolerance(jg.getZoom(),i));if(!this._parseCache[jf]){this._parseCache[jf]=[]}this._parseCache[jf][T]=e;return e}},_clipLine:function(je){var e=this.map;var jk=[];var jn=Math.round(e.offsetX);var jm=Math.round(e.offsetY);var jo=e.config.drawMargin;var jg={minX:-jn-jo,minY:-jm-jo,maxX:-jn+jo+e.width,maxY:-jm+jo+e.height};for(var jh=0,T=je.length-1;jh<T;jh++){var jj=je[jh];var ji=je[jh+1];var jl=bi(jj,ji,jg);if(jl){jk.push(jl)}}var jf=[[]];for(var jh=0,T=jk.length;jh<T;jh++){if(jk[jh].clip){jf[jf.length-1].push(jk[jh].pixel0);jf[jf.length-1].push(jk[jh].pixel1);if(jk[jh+1]&&jk[jh+1].clip){jf.push([])}}else{jf[jf.length-1].push(jk[jh].pixel0);if(jh===jk.length-1){jf[jf.length-1].push(jk[jh].pixel1)}}}return jf},_getEachDisplayPixelsGL:function(jk,jh){var T=this.map;var jj=[];if(jk.length===0||!this.isVisible()){return[jj]}jk=this._simplification(jk,jh);if(this._config.clip===true){return this._clipLineGL(jk,jh)}var e=T._polyOverlayBasePoint;jj.push([jk[0].lng-e.lng,jk[0].lat-e.lat]);for(var jg=1,jf=1,je=jk.length;jg<je;jg++){var ji=[jk[jg].lng-e.lng,jk[jg].lat-e.lat];if(ji[0]!==jj[jf-1][0]||ji[1]!==jj[jf-1][1]){jj.push(ji);jf++}}return[jj]},_clipLineGL:function(jo,jh){var jt=this.map;var jg=this.getParseCacheIndex(jt.getZoom());var ju=jt._polyOverlayBasePoint;var jf=[];if(this._parseCacheGLRaw[jg]&&this._parseCacheGLRaw[jg][jh]){jf=this._parseCacheGLRaw[jg][jh]}else{var jv=new eO(jo[0].lng-ju.lng,jo[0].lat-ju.lat);jf.push(jv);for(var jp=1,jm=1,jl=jo.length;jp<jl;jp++){var je=new eO(jo[jp].lng-ju.lng,jo[jp].lat-ju.lat);if(!je.equals(jf[jm-1])){jf.push(je);jm++}}if(!this._parseCacheGLRaw[jg]){this._parseCacheGLRaw[jg]=[]}this._parseCacheGLRaw[jg][jh]=jf}var e=jt.getZoomUnits();var js=jt.pixelToPointIn(new eO(0,jt.height));var jr=[];var jj=jt.config.drawMarginGL;var ji={minX:Math.round(-jj*e+(js.lng-ju.lng)),minY:Math.round(-jj*e+(js.lat-ju.lat)),maxX:Math.round((jj+jt.width)*e+(js.lng-ju.lng)),maxY:Math.round((jj+jt.height)*e+(js.lat-ju.lat))};for(jp=0,jl=jf.length-1;jp<jl;jp++){var jq=jf[jp];var jn=jf[jp+1];var T=bi(jq,jn,ji);if(T){jr.push(T)}}var jk=[[]];for(jp=0,jl=jr.length;jp<jl;jp++){if(jr[jp].clip){jk[jk.length-1].push([jr[jp].pixel0.x,jr[jp].pixel0.y]);jk[jk.length-1].push([jr[jp].pixel1.x,jr[jp].pixel1.y]);if(jr[jp+1]&&jr[jp+1].clip){jk.push([])}}else{jk[jk.length-1].push([jr[jp].pixel0.x,jr[jp].pixel0.y]);if(jp===jr.length-1){jk[jk.length-1].push([jr[jp].pixel1.x,jr[jp].pixel1.y])}}}return jk},getParsedPoints:function(){var jh=this.map;var i=this.points;var e=[];var T=this;var jg=i.slice(0);if(this.greatCirclePoints.length>0){jg[0]=this.greatCirclePoints}ev.each(jg,function(jk){var jj=jh.config.coordType===2?1:jh.config.coordType;var ji=ds(jk,T.getParseTolerance(jh.getZoom(),jj));e.push(ji)});var jf=0;if(this._bounds.sw.lng<-g0.WORLD_SIZE_MC_HALF){jf=g0.WORLD_SIZE_MC}if(this._bounds.ne.lng>g0.WORLD_SIZE_MC_HALF){jf=-g0.WORLD_SIZE_MC}if(jf===0){return e}var je=e.slice(0);ev.each(je,function(ji){var jj=[];ev.each(ji,function(jk){jj.push(new cf(jk.lng+jf,jk.lat))});e.push(jj)});console.log(e);return e},setPointAt:function(T,e,je){je=je||0;if(!e||!this.points[je][T]||!this.points[je][T]){return}this._clearCache();this.points[je][T]=new cf(e.lng,e.lat);if(this._config.geodesic===true){this.calcGreatCirclePoints(ig.convertMC2LL(this.points[je][0]),ig.convertMC2LL(this.points[je][1]))}this._calcBounds();this.draw();var i=new fa("onlineupdate");i.overlay=this;this.dispatchEvent(i)},calcGreatCirclePoints:function(je,T){if(je.equals(T)){return}var e=ig.getDistance(hM(je.lng),hM(je.lat),hM(T.lng),hM(T.lat));if(e<250000){return}this.greatCirclePoints.length=0;var ji=Math.round(e/150000);var jm=this.calcAngularDistance(je,T);this.greatCirclePoints.push(this.points[0][0]);var jl=je.lng;var jk=this.points[0][0];for(var jf=0;jf<ji;jf++){var jh=this.calcMiddlePoint(je,T,jf/ji,jm);var jj=ig.convertLL2MC(jh);var jg=jj.lng;var jn=dZ(jj,jk);if(jn>30037726){if(jj.lng<jk.lng){jj.lng+=g0.WORLD_SIZE_MC}else{jj.lng-=g0.WORLD_SIZE_MC}}this.greatCirclePoints.push(jj);jk=jj}this.greatCirclePoints.push(this.points[0][1]);var jn=dZ(this.points[0][1],jk);if(jn>30037726){if(this.points[0][1].lng<jk.lng){this.points[0][1].lng+=g0.WORLD_SIZE_MC}else{this.points[0][1].lng-=g0.WORLD_SIZE_MC}}},calcMiddlePoint:function(jl,jk,jm,jq){var jf=jl.lat;var je=jk.lat;var jp=jl.lng;var jn=jk.lng;var jr=hM(jf);var jo=hM(je);var i=hM(jp);var e=hM(jn);var jt=Math.sin((1-jm)*jq)/Math.sin(jq);var js=Math.sin(jm*jq)/Math.sin(jq);var ji=jt*Math.cos(jr)*Math.cos(i)+js*Math.cos(jo)*Math.cos(e);var jh=jt*Math.cos(jr)*Math.sin(i)+js*Math.cos(jo)*Math.sin(e);var jg=jt*Math.sin(jr)+js*Math.sin(jo);var T=Math.atan2(jg,Math.sqrt(Math.pow(ji,2)+Math.pow(jh,2)));var jj=Math.atan2(jh,ji);return new cf(eG(jj),eG(T))},calcAngularDistance:function(jf,i){var jg=hM(jf.lat);var je=hM(i.lat);var T=hM(jf.lng);var e=hM(i.lng);return Math.acos(Math.sin(jg)*Math.sin(je)+Math.cos(jg)*Math.cos(je)*Math.cos(Math.abs(e-T)))}});ev.extend(gB.prototype,{initialize:function(i){hL.prototype.initialize.call(this,i);var e=this._config;this.setOptions({strokeColor:e.strokeColor,strokeWeight:e.strokeWeight,strokeStyle:e.strokeStyle,fillColor:e.fillColor,strokeOpacity:e.strokeOpacity,fillOpacity:e.fillOpacity});return this.domElement},setPointAt:function(T,e){if(!this._userPoints[T]){return}this._clearCache();this._userPoints[T]=new cf(e.lng,e.lat);this.points[T]=new cf(e.lng,e.lat);if(T===0&&!this.points[0].equals(this.points[this.points.length-1])){this.points[this.points.length-1]=new cf(e.lng,e.lat)}this._calcBounds();this.draw();var i=new fa("onlineupdate");i.overlay=this;this.dispatchEvent(i)},setPositionAt:function(i,e){if(!this._userPoints[i]){return}var T=ig.convertLL2MC(e);this.setPointAt(i,T);if(this._config.enableEditing===true&&!this._config.geodesic){this.clearVertexs();this.addVertexs()}},_onMarkerDragging:function(jl){this._editstate=true;var je=jl.currentTarget;var jn=jl.point;var jm=je.index;var i=this.vertexPoints;var jp;var ji=i[2].p;var jo=i[i.length-2].p;var jj=null;var T=null;var jk=null;var jh=null;if(jm===0){jk=i[jm+2].p;jp=[jo,jn,jk];if(!je.t){jj=new cf((jo.lng+jn.lng)/2,(jo.lat+jn.lat)/2);T=new cf((jk.lng+jn.lng)/2,(jk.lat+jn.lat)/2)}}else{if(jm===i.length-1){jh=i[jm-2].p;jp=[jh,jn,ji];if(!je.t){jj=new cf((jh.lng+jn.lng)/2,(jh.lat+jn.lat)/2);T=new cf((ji.lng+jn.lng)/2,(ji.lat+jn.lat)/2)}}else{jh=i[jm-1].p;jk=i[jm+1].p;jp=[jh,jn,jk];if(!je.t){jh=i[jm-2].p;jk=i[jm+2].p;jp=[jh,jn,jk];jj=new cf((jh.lng+jn.lng)/2,(jh.lat+jn.lat)/2);T=new cf((jk.lng+jn.lng)/2,(jk.lat+jn.lat)/2);if(this.vertexMarkers[jm-1]){this.vertexMarkers[jm-1].hide()}if(this.vertexMarkers[jm+1]){this.vertexMarkers[jm+1].hide()}}}}if(!this._temp.dashedLine){var jg=new fl(jp,{strokeStyle:"dashed",strokeColor:this._config.strokeColor,strokeWeight:this._config.strokeWeight,strokeOpacity:this._config.strokeOpacity});this.map.addOverlay(jg);this._temp.dashedLine=jg}else{this._temp.dashedLine.setPoints(jp)}if(this._config.nodeT&&this._config.nodeT instanceof iy){var jf=this._config.nodeT}else{var jf=new iy(w.imgPath+"nodeT.gif",new h8(11,11),{offset:new h8(5,5)})}if(!this._temp.preTNode&&jj){this._temp.preTNode=new iU(jj,{icon:jf});this.map.addOverlay(this._temp.preTNode)}else{if(jj){this._temp.preTNode.setPoint(jj)}}if(!this._temp.nexTNode&&T){this._temp.nexTNode=new iU(T,{icon:jf});this.map.addOverlay(this._temp.nexTNode)}else{if(T){this._temp.nexTNode.setPoint(T)}}},getFillStyleForGL:function(){var e=this._config.fillOpacity;var i;i=gR.formatColorCssToRgbaArray(this._config.fillColor,e);this._fillStyleInfoForGL=i.join(",");return this._fillStyleInfoForGL},buildFillVertex:function(jh){var jl=[];var jj=this.getParseCacheIndex(this.map.getZoom());if(this._areaCacheGL[jj]){return this._areaCacheGL[jj]}var jk=this._getDisplayPixelsGL(this.points);if(jk.pointsArray&&jk.pointsArray.length<3){this._areaCacheGL[jj]=[[],jl];return this._areaCacheGL[jj]}var jf;var jg=[];var je=0;for(var T=0;T<jk.length;T++){if(T>0){je+=jk[T-1].length}jf=jh(jk[T].pointsArray,null,null,je);for(var e=0,ji=jf.length;e<ji;e+=3){jl.push(jf[e],jf[e+1],jf[e+2])}jg=jg.concat(jk[T].pointsArray)}var jm=[new Float32Array(jg),new Uint16Array(jl)];this._areaCacheGL[jj]=jm;return jm}});ev.extend(gi.prototype,{initialize:function(e){gB.prototype.initialize.call(this,e);this.points=this._getPerimeterPoints(this.point,this.radius);this._calcBounds();return this.domElement},_addDom:function(){if(this.map._renderType==="webgl"){return}var e=this._drawer=fm.getDrawer(this.map);this.domElement=e.addStandardCircle()},draw:function(i){if(!this.domElement){return}i=i||{};var T=this.getDisplayGeometry(i.center,i.zoom);if(this._drawer){this._drawer.setStandardCircleGeometry(this.domElement,T)}},getDisplayGeometry:function(e,i){var T=this.map.pointToOverlayPixelIn(this.point,{zoom:i,center:e});var jf=Math.round(this._radiusMercator/this.map.getZoomUnits(i));var je={cx:T.x,cy:T.y,radius:jf};return je},setPoint:function(e,T){if(!e){return}this._clearCache();if(!T){this.vertexPoints=null}this.point=e;this.latLng=ig.convertMC2LL(e);this.points=this._getPerimeterPoints(e,this.radius);this._calcBounds();this.draw();var i=new fa("onlineupdate");i.overlay=this;this.dispatchEvent(i)},setRadius:function(e,T){this._clearCache();if(!T){this.vertexPoints=null}this.radius=Math.abs(e);this.points=this._getPerimeterPoints(this.point,this.radius);this._calcBounds();this.draw();var i=new fa("onlineupdate");i.overlay=this;this.dispatchEvent(i)},getParseTolerance:function(i,e){if(e===2){e=1}if(this._config.getParseTolerance){return this._config.getParseTolerance(i,e)}return gi.parseTolerance[e][this.getParseCacheIndex(i)]},_onMarkerDragging:function(jh){var jf;var jj;var jk;var i=this.map;this._editstate=true;var je=jh.currentTarget;var ji=je.index;var T=this.vertexPoints;var jg=T[0].p;var jl=T[T.length-1].p;if(ji==0){jj=je.point;jk=jl}else{jj=jg;jk=je.point}jf=ig.getDistanceByMC(jj,jk);this.setRadius(jf,true);this.setCenterIn(jj,true)},_onMarkerDragend:function(jf){this._editstate=false;var je=jf.currentTarget;var T=je.index;this.vertexPoints[0]={p:this.point,t:0};if(T==1){this.vertexPoints[1]={p:je.point,t:0}}this.clearVertexs();this.addVertexs();var i=new fa("oneditend");i.pixel=jf.pixel;i.point=jf.point;i.latLng=jf.latLng;i.overlay=this;this.dispatchEvent(i)},getVertexPoints:function(){if(!this.vertexPoints){var e=[];e.push({p:this.point,t:0});e.push({p:this.points[Math.floor(this.points.length*3/4)],t:0});this.vertexPoints=e}return this.vertexPoints}});ev.extend(i5.prototype,{initialize:function(i){hL.prototype.initialize.call(this,i);var e=this._config;this.setOptions({topFillColor:e.topFillColor,topFillOpacity:e.topFillOpacity,sideFillColor:e.sideFillColor,sideFillOpacity:e.sideFillOpacity,altitude:e.altitude});return this.domElement},setPointAt:function(T,e){if(!this._userPoints[T]){return}this._clearCache();this._userPoints[T]=new cf(e.lng,e.lat);this.points[T]=new cf(e.lng,e.lat);if(T===0&&!this.points[0].equals(this.points[this.points.length-1])){this.points[this.points.length-1]=new cf(e.lng,e.lat)}this._calcBounds();this.draw();var i=new fa("onlineupdate");i.overlay=this;this.dispatchEvent(i)},getFillStyleForGL:function(){var T=this._config.topFillOpacity;var i=this._config.sideFillOpacity;var e;var je;e=gR.formatColorCssToRgbaArray(this._config.topFillColor,T,false);je=gR.formatColorCssToRgbaArray(this._config.sideFillColor,i,false);return{top:e,side:je}},buildFillVertex:function(jg,jA){var jf=this.getParseCacheIndex(this.map.getZoom());if(this._areaCacheGL[jf]&&!jA){return this._areaCacheGL[jf]}var jD=this._getDisplayPixelsGL(this.points);if(jD.pointsArray&&jD.pointsArray.length<3){this._areaCacheGL[jf]={vertex:[],index:[]};return this._areaCacheGL[jf]}var jy=this.getFillStyleForGL();var jr=jy.top;var jv=jy.side;var jk=this._config.altitude;var jH=[0,0,1];var jm=[];var T=[];var jx=0;for(var jB=0;jB<jD.length;jB++){if(jB>0){jx+=(jD[jB-1].length-1)*5}var ju=jD[jB].pointsArray;ju.splice(-2,2);var jI=this.getClockwise(ju);if(jI){ju=this.rev(ju)}for(var jE=0;jE<ju.length;jE+=2){jm.push([ju[jE],ju[jE+1],jk,jH[0],jH[1],jH[2],jr[0],jr[1],jr[2],jr[3]])}var e=jg(ju,null,null,jx);for(var jE=0,jp=e.length;jE<jp;jE+=3){T.push(e[jE],e[jE+1],e[jE+2])}for(var jE=0,jw=ju.length;jE<jw;jE+=2){var jl=ju[jE];var jj=ju[jE+1];var jt=[jl,jj,0];var js=[jl,jj,jk];var je=jE+2;var ji=jE+3;if(jE===jw-2){je=0;ji=1}var jG=ju[je];var jF=ju[ji];var jq=[jG,jF,0];var jo=[jG,jF,jk];var jC=[jq[0]-jt[0],jq[1]-jt[1],jq[2]-jt[2]];var jz=[js[0]-jt[0],js[1]-jt[1],js[2]-jt[2]];var jH=[];vec3.cross(jH,jC,jz);jt.push(jH[0],jH[1],jH[2]);js.push(jH[0],jH[1],jH[2]);jq.push(jH[0],jH[1],jH[2]);jo.push(jH[0],jH[1],jH[2]);jt.push(jv[0],jv[1],jv[2],jv[3]);js.push(jv[0],jv[1],jv[2],jv[3]);jq.push(jv[0],jv[1],jv[2],jv[3]);jo.push(jv[0],jv[1],jv[2],jv[3]);var jh=jm.length;jm.push(jt);jm.push(js);jm.push(jq);jm.push(jo);T.push(jh,jh+2,jh+3,jh,jh+3,jh+1)}}var jn={vertex:this.convertBuilding3dToTypedArray(jm),index:new Uint16Array(T)};this._areaCacheGL[jf]=jn;return jn},getClockwise:function(jk){var jg=jk.length;if(jg<6){return false}var je=jk[jg-2];var jj=jk[jg-1];var T=jk[0];var ji=jk[1];var e=jk[2];var jh=jk[3];for(var jf=2;jf<jg;jf+=2){if(jk[jf]>T){je=jk[jf-2];jj=jk[jf-1];T=jk[jf];ji=jk[jf+1];if(jf+2>=jg){e=jk[0];jh=jk[1]}else{e=jk[jf+2];jh=jk[jf+3]}}}return((T-je)*(jh-ji)-(ji-jj)*(e-T)<0)},rev:function(je){var e=[];for(var T=je.length-1;T>=0;T-=2){e[je.length-1-T]=je[T-1];e[je.length-1-T+1]=je[T]}return e},convertBuilding3dToTypedArray:function(jh){var T=jh.length;var je=new Float32Array(T*7);var jg=new DataView(je.buffer);var e=0;for(var jf=0;jf<jh.length;jf++){e=jf*7;je[e+0]=jh[jf][0];je[e+1]=jh[jf][1];je[e+2]=jh[jf][2];je[e+3]=jh[jf][3];je[e+4]=jh[jf][4];je[e+5]=jh[jf][5];jg.setUint8(e*4+24,jh[jf][6]);jg.setUint8(e*4+25,jh[jf][7]);jg.setUint8(e*4+26,jh[jf][8]);jg.setUint8(e*4+27,jh[jf][9])}return je}});ev.extend(bM.prototype,{initialize:function(e){hL.prototype.initialize.call(this,e);return this.domElement},getFillStyleForGL:function(){if(!this._config.url){return}switch(this._config.type){case"image":var e={type:"image",texture:this._config.url,opacity:this._config.opacity};this._fillStyleInfoForGL=e;break;case"video":var e={type:"video",texture:this._config.url,opacity:this._config.opacity};this._fillStyleInfoForGL=e;break;case"canvas":var e={type:"canvas",texture:this._config.url,opacity:this._config.opacity};this._fillStyleInfoForGL=e;break}return this._fillStyleInfoForGL},buildFillVertex:function(jh){var jk=[];var jj=this._getDisplayPixelsGL(this.points);var jf;var jg=[];var je=0;for(var T=0;T<jj.length;T++){if(T>0){je+=jj[T-1].length}jf=jh(jj[T].pointsArray,null,null,je);for(var e=0,ji=jf.length;e<ji;e+=3){jk.push(jf[e],jf[e+1],jf[e+2])}jg=jg.concat(jj[T].pointsArray)}var jl=[new Float32Array(jg),new Uint16Array(jk)];return jl},buildFillMaskVertex:function(){var jj=[0,0,1,0,1,1,0,1];var jk=this._getDisplayPixelsGL(this.points);var T=this._config.maskCoord;if(this.hasMaskPng&&T&&T.length===2){var e=[];for(var ji=0;ji<T.length;ji++){e[ji]=ig.convertLL2MC(T[ji])}var jn=this._toOverlayPixelsGL(e);this.maskOverlayPixels=jn;var jh=jn[1][0]-jn[0][0];var jf=jn[1][1]-jn[0][1];var jm=(jk[0][0][0]-jn[0][0])/jh;var jl=(jk[0][0][1]-jn[0][1])/jf;var jg=(jk[0][2][0]-jn[0][0])/jh;var je=(jk[0][2][1]-jn[0][1])/jf;jj=[jm,jl,jg,jl,jg,je,jm,je]}else{this.maskOverlayPixels=[jk[0][0],jk[0][2]]}return jj}});function K(e){this._map=e;this._canvasAttrName={strokeweight:"lineWidth",strokecolor:"strokeStyle",fillcolor:"fillStyle",strokeopacity:"globalAlpha",fillopacity:"globalAlpha"};this._type="canvas"}K.prototype=new eB();var cy=K.prototype;cy.addLine=function(){var i=bL("canvas");this._map.getPanes().mapPane.appendChild(i);i.style.position="absolute";var e=i.getContext("2d");e.lineCap="round";e.lineJoin="round";e.save();return i};cy.setPath=function(T,i){if(!T){return}var e=T.getContext("2d");this._setCanvasPosition(T);this._clearCanvas(e);var jf=parseInt(T.style.top);var je=parseInt(T.style.left);e.beginPath();ev.each(i,function(ji){if(ji.length===0){return}e.moveTo(ji[0].x-je,ji[0].y-jf);for(var jh=1,jg=ji.length;jh<jg;jh++){e.lineTo(ji[jh].x-je,ji[jh].y-jf)}});this._drawCanvas(T)};cy.setAttribute=function(je,i,jf){if(!je){return}var e=je.getContext("2d");var T=this._getAttributeName(i);if(T){e[T]=jf}je.setAttribute("_"+i,jf||"");e.save();this._clearCanvas(e);this._drawCanvas(je)};cy._getAttributeName=function(e){return this._canvasAttrName[e]||e};cy._setCanvasPosition=function(jf){var i=this._map;var jk=i.config.drawMargin;var T=i.width+2*jk;var jh=i.height+2*jk;var je=-i.offsetX-jk;var jg=-i.offsetY-jk;var jj=jf.getContext("2d");var ji={strokeStyle:jj.strokeStyle,fillStyle:jj.fillStyle,globalAlpha:jj.globalAlpha,lineWidth:jj.lineWidth,lineCap:"round",lineJoin:"round"};jf.setAttribute("width",T);jf.setAttribute("height",jh);for(var e in ji){jj[e]=ji[e]}jj.save();var jl=jf.style;jl.top=jg+"px";jl.left=je+"px"};cy._clearCanvas=function(e){e.clearRect(0,0,9999,9999)};cy._drawCanvas=function(i){var e=i.getContext("2d");e.globalAlpha=i.getAttribute("_fillopacity");if(e.globalAlpha!=0&&i.getAttribute("_fillcolor")){e.fill()}e.globalAlpha=i.getAttribute("_strokeopacity");if(e.globalAlpha!==0&&i.getAttribute("_strokecolor")){e.stroke()}};cy.addStandardCircle=function(){var i=bL("canvas");this._map.getPanes().mapPane.appendChild(i);i.style.position="absolute";var e=i.getContext("2d");e.lineCap="round";e.lineJoin="round";e.save();return i};cy.setStandardCircleGeometry=function(je,jh){if(!je){return}var T=je.getContext("2d");this._setCanvasPosition(je);this._clearCanvas(T);var jg=parseInt(je.style.top);var jf=parseInt(je.style.left);var i=jh.cx-jf;var ji=jh.cy-jg;var e=jh.radius;T.beginPath();T.arc(i,ji,e,0,Math.PI*2);this._drawCanvas(je)};function eB(){}DrawerPrototype=eB.prototype;DrawerPrototype.setPalette=function(){};DrawerPrototype.addLine=function(){throw"addLineæ¥å£æ²¡æå®ç°"};DrawerPrototype.setAttribute=function(){throw"setAttributeæ¥å£æ²¡æå®ç°"};DrawerPrototype.setPath=function(){throw"setPathæ¥å£æ²¡æå®ç°"};DrawerPrototype.getType=function(){return this._type};var fm={getDrawer:function(e){if(e._renderType==="webgl"){return null}if(!fm["_"+e.hashCode]){fm["_"+e.hashCode]={}}switch(e.config.drawer){case BMAP_SVG_DRAWER:return fm.getSvgDrawer(e);case BMAP_VML_DRAWER:return fm.getVmlDrawer(e);case BMAP_CANVAS_DRAWER:return fm.getCanvasDrawer(e);default:break}if(fm.isSupportSvg()){return fm.getSvgDrawer(e)}if(fm.isSupportVml()){return fm.getVmlDrawer(e)}if(fm.isSupportCanvas()){return fm.getCanvasDrawer(e)}},getSvgDrawer:function(e){if(!fm["_"+e.hashCode]._svgDrawer){fm["_"+e.hashCode]._svgDrawer=new ej(e)}return fm["_"+e.hashCode]._svgDrawer},getVmlDrawer:function(e){if(!fm["_"+e.hashCode]._vmlDrawer){fm["_"+e.hashCode]._vmlDrawer=new ag(e)}return fm["_"+e.hashCode]._vmlDrawer},getCanvasDrawer:function(e){if(!fm["_"+e.hashCode]._canvasDrawer){fm["_"+e.hashCode]._canvasDrawer=new K(e)}return fm["_"+e.hashCode]._canvasDrawer},isSupportVml:function(){if(typeof fm.supportVml!="undefined"){return fm.supportVml}var T=document.body.appendChild(bL("div"));T.innerHTML=\'<v:shape id="vml_tester1" adj="1" />\';var i=T.firstChild;if(!i.style){return false}i.style.behavior="url(#default#VML)";var e=i?typeof i.adj=="object":true;T.parentNode.removeChild(T);fm.supportVml=e;return e},isSupportSvg:function(){if(typeof fm.supportSvg=="undefined"){fm.supportSvg=!!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Shape","1.1")}return fm.supportSvg},isSupportCanvas:function(){if(typeof fm.supportCanvas=="undefined"){fm.supportCanvas=!!bL("canvas").getContext}return fm.supportCanvas}};bp.DrawerSelector=fm;function ej(e){this._map=e;this.SVG_NS="http://www.w3.org/2000/svg";this._svgAttrName={strokeweight:"stroke-width",strokecolor:"stroke",fillcolor:"fill",strokeopacity:"stroke-opacity",fillopacity:"fill-opacity",strokestyle:"stroke-dasharray",strokelinecap:"stroke-linecap",strokelinejoin:"stroke-linejoin"};this._svg=this._createSvg();this._type="svg"}ej.prototype=new eB();var cd=ej.prototype;cd._createSvg=function(){var e=this._svg=bL("svg",{},this.SVG_NS);e.setAttribute("version","1.1");e.setAttribute("type","system");var i=e.style;i.position="absolute";i.MozUserSelect="none";this.setPalette();this._map.getPanes().mapPane.appendChild(e);return e};cd.setPalette=function(){if(!this._svg){return}var T=this._svg;var ji=this._map;var i=ji.config.drawMargin;var jf=ji.width+2*i;var e=ji.height+2*i;var jh=-ji.offsetX-i;var jg=-ji.offsetY-i;this.setAttribute(T,"x",jf+"px");this.setAttribute(T,"y",e+"px");this.setAttribute(T,"viewBox",jh+" "+jg+" "+jf+" "+e);var je=T.style;je.top=jg+"px";je.left=jh+"px";je.width=jf+"px";je.height=e+"px"};cd.getPalette=function(){return this._svg};cd.setAttribute=function(jf,T,jg,je,i){if(!jf){return}if(T==="strokestyle"){i=i||{};var je=i.strokeWeight||4;var e=i.dashArray||null;switch(jg){case"dashed":if(e){jg=e.join(",")}else{jg=je*2}break;case"dotted":if(i.strokeLineCap==="round"){jg="1,"+2*je}else{jg=je}break;default:jg=0;break}}var jh=jg||"none";if(jg===0){jh=0}jf.setAttributeNS(null,this._getAttributeName(T),jh);return jf};cd._getAttributeName=function(e){return this._svgAttrName[e]||e};cd.addLine=function(){var e=bL("path",{},this.SVG_NS);this.setAttribute(e,"fill-rule","evenodd");this._svg.appendChild(e);return e};cd.setPath=function(T,e){var i=this._getPathString(e)||"M -9999,-9999";this.setAttribute(T,"d",i)};cd._getPathString=function(e){if(e.length===0){return""}var i=[];ev.each(e,function(jf){if(jf.length<2){return}i.push("M "+jf[0].x+" "+jf[0].y+" L");for(var je=1,T=jf.length;je<T;je++){i.push(jf[je].x);i.push(jf[je].y)}});return i.join(" ")};cd.addStandardCircle=function(){var e=bL("circle",{},this.SVG_NS);this._svg.appendChild(e);return e};cd.setStandardCircleGeometry=function(T,je){var i=je.cx;var jf=je.cy;var e=je.radius;this.setAttribute(T,"cx",i);this.setAttribute(T,"cy",jf);this.setAttribute(T,"r",e)};function ag(e){this._map=e;this._vmlAttrName={strokeweight:"weight",strokecolor:"color",fillcolor:"color",strokeopacity:"opacity",fillopacity:"opacity",strokestyle:"dashstyle"};this._type="vml"}ag.prototype=new eB();var dl=ag.prototype;dl.setAttribute=function(T,e,je){if(T){if(e.indexOf("stroke")==0){T=T.getElementsByTagName("stroke")[0]}else{if(e.indexOf("fill")==0){T=T.getElementsByTagName("fill")[0]}}if(e.indexOf("color")>0){if(!je){T.on=false}else{T.on=true}}if(e=="strokestyle"){switch(je){case"dashed":je="4 2 1 2";break;case"dotted":je="1 1";break;default:je="solid";break}}if(e=="strokeweight"){je=je+"px"}var i=this._getAttributeName(e);T[i]=je||""}};dl._getAttributeName=function(e){return this._vmlAttrName[e]||e};dl.addLine=function(){var e=[\'<v:shape style="behavior:url(#default#VML);z-index:1;width:1px;height:1px;position:absolute;left:0;top:0;"\',\'coordsize="1,1" coordorigin="0,0" filled="t" fillcolor="white">\',\'<v:stroke style="behavior:url(#default#VML);" endcap="round" oned="true" />\',\'<v:fill style="behavior:url(#default#VML);" />\',"</v:shape>"].join("");return bB(this._map.getPanes().mapPane,e)};dl.setPath=function(i,e){this.setAttribute(i,"path",this._getPathString(e));if(ev.Browser.ie==6){i.style.display="none";i.style.display=""}};dl._getPathString=function(e){if(e.length==0){return""}var i=[];ev.each(e,function(jf){if(jf.length<2){return}i.push("m "+jf[0].x+" "+jf[0].y+" l");for(var je=1,T=jf.length;je<T;je++){i.push(jf[je].x);i.push(jf[je].y)}i.push("e")});return i.join(" ")||" "};dl.addStandardCircle=function(){var e=[\'<v:oval style="behavior:url(#default#VML);z-index:1;width:1px;height:1px;position:absolute;left:0;top:0;">\',\'<v:stroke style="behavior:url(#default#VML);" endcap="round" oned="true" />\',\'<v:fill style="behavior:url(#default#VML);" />\',"</v:oval>"].join("");return bB(this._map.getPanes().mapPane,e)};dl.setStandardCircleGeometry=function(T,je){var i=je.cx;var jf=je.cy;var e=je.radius;T.style.left=(i-e)+"px";T.style.top=(jf-e)+"px";T.style.width=(e*2)+"px";T.style.height=(e*2)+"px";if(ev.Browser.ie===6){T.style.display="none";T.style.display=""}};');
