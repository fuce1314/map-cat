/**/﻿_jsload&&_jsload('route', 'function eg(e,jf,i){cM.call(this);if(!e){return}this.container=(typeof(e)=="object")?e:ev.G(e);this.page=1;this.pageCount=100;this.argName="pg";this.pagecap=4;this.callback=jf;this.update=true;var T={page:1,totalCount:100,pageCount:100,pagecap:4,argName:"pg",update:true};if(!i){i=T}for(var je in i){if(typeof(i[je])!="undefined"){this[je]=i[je]}}this.render()}ev.extend(eg.prototype,{render:function(){this.initialize()},initialize:function(){this.checkPages();this.container.innerHTML=this.createHtml()},checkPages:function(){if(isNaN(parseInt(this.page))){this.page=1}if(isNaN(parseInt(this.pageCount))){this.pageCount=1}if(this.page<1){this.page=1}if(this.pageCount<1){this.pageCount=1}if(this.page>this.pageCount){this.page=this.pageCount}this.page=parseInt(this.page);this.pageCount=parseInt(this.pageCount)},getPage:function(){var i=location.search;var T=new RegExp("[?&]?"+this.argName+"=([^&]*)[&$]?","gi");var e=i.match(T);this.page=RegExp.$1},createHtml:function(){var jk=[];var je=this.page-1;var jh=this.page+1;jk.push(\'<p style="margin:0;padding:0;white-space:nowrap">\');if(je<1){}else{if(this.page>=this.pagecap){var T=\'<span style="margin-right:3px"><a style="color:#7777cc" href="javascript:void(0)" onclick="{temp1}">首页</a></span>\';jk.push(T.replace("{temp1}","BMapGL.I(\'"+this.hashCode+"\').toPage(1);"))}var T=\'<span style="margin-right:3px"><a style="color:#7777cc" href="javascript:void(0)" onclick="{temp2}">上一页</a></span>\';jk.push(T.replace("{temp2}","BMapGL.I(\'"+this.hashCode+"\').toPage("+je+");"))}if(this.page<this.pagecap){if(this.page%this.pagecap==0){var jf=this.page-this.pagecap-1}else{var jf=this.page-this.page%this.pagecap+1}var ji=jf+this.pagecap-1}else{var jj=Math.floor(this.pagecap/2);var jg=this.pagecap%2-1;if(this.pageCount>this.page+jj){var ji=this.page+jj;var jf=this.page-jj-jg}else{var ji=this.pageCount;var jf=this.page-jj-jg}}if(this.page>this.pageCount-this.pagecap&&this.page>=this.pagecap){var jf=this.pageCount-this.pagecap+1;var ji=this.pageCount}for(var e=jf;e<=ji;e++){if(e>0){if(e==this.page){jk.push(\'<span style="margin-right:3px">\'+e+"</span>")}else{if(e>=1&&e<=this.pageCount){var T=\'<span><a style="color:#7777cc;margin-right:3px" href="javascript:void(0)" onclick="{temp3}">[\'+e+"]</a></span>";jk.push(T.replace("{temp3}","BMapGL.I(\'"+this.hashCode+"\').toPage("+e+");"))}}}}if(jh>this.pageCount){}else{var T=\'<span><a style="color:#7777cc" href="javascript:void(0)" onclick="{temp4}">下一页</a></span>\';jk.push(T.replace("{temp4}","BMapGL.I(\'"+this.hashCode+"\').toPage("+jh+");"))}jk.push("</p>");return jk.join("")},toPage:function(i){var e=i?i:1;if(typeof(this.callback)=="function"){this.callback(e);this.page=e}if(this.update){this.render()}}});function cW(e){this["city"]=e.city;this._start=e.start;this._end=e.end;this._plans=e.plans;this["moreResultsUrl"]=e.url;this["taxiFare"]=e.taxiFare||null;this._startStatus=e.startStatus||BMAP_ROUTE_STATUS_NORMAL;this._endStatus=e.endStatus||BMAP_ROUTE_STATUS_NORMAL}ev.extend(cW.prototype,{getStart:function(){return this._start},getEnd:function(){return this._end},getStartStatus:function(){return this._startStatus},getEndStatus:function(){return this._endStatus},getNumPlans:function(){return this._plans.length},getPlan:function(e){if(this._plans[e]){return this._plans[e]}}});function hc(e){cW.call(this,e);this["policy"]=e.policy}ev.inherit(hc,cW,"DrivingRouteResult");function o(e){cW.call(this,e)}ev.inherit(o,cW,"WalkingRouteResult");function eP(e){cW.call(this,e)}ev.inherit(eP,cW,"RidingRouteResult");function dc(e){cW.call(this,e);this["policy"]=e.policy;this["transitType"]=e.transitType;this["intercityPolicy"]=e.intercityPolicy;this["transitTypePolicy"]=e.transitTypePolicy}ev.inherit(dc,cW,"TransitRouteResult");ev.extend(dc.prototype,{getTransitType:function(){return this["transitType"]}});function f2(e){this._routes=e.routes.slice(0);this._distance=e.distance||0;this._duration=e.duration||0;this._dragPois=e.dragPois||[]}ev.extend(f2.prototype,{getRoute:function(e){if(this._routes[e]){return this._routes[e]}},getNumRoutes:function(){return this._routes.length},getDistance:function(e){if(e===false){return this._distance}else{return hU(this._distance)}},getDuration:function(e){if(e===false){return this._duration}else{return ay(this._duration,"nav")}},getDragPois:function(){return this._dragPois}});function eb(e){f2.call(this,e);this._lines=e.lines;this._description=e.description;this._duration=e.duration||0;this._totalType=e.totalType||[];this._total=e.total||[]}ev.inherit(eb,f2,"TransitRoutePlan");ev.extend(eb.prototype,{getNumLines:function(){return this._lines.length},getLine:function(e){if(this._lines[e]){return this._lines[e]}},getDescription:function(e){if(e===false){return by.removeHtml(this._description)}else{return this._description}},getDuration:function(e){if(e===false){return this._duration}else{return ay(this._duration,"bustime")}},getLinesTitle:function(){var je="";var e=this._lines.length-1;for(var T=0;T<e;T++){if(this._lines[T]&&this._lines[T]["title"]){je+=this._lines[T]["title"]+" → "}}je+=this._lines[e]["title"];return je},getBusName:function(e){return e.substring(0,e.indexOf("("))},getWalkDistance:function(){var T=0;var e=this._routes.length;for(var je=0;je<e;je++){T+=this._routes[je].getDistance(false)}return hU(T)},getNumTotal:function(){return this._totalType.length},getTotalType:function(e){return this._totalType[e]},getTotal:function(e){return this._total[e]}});function dh(e){this._steps=e.steps&&e.steps.slice(0)||[];this._distance=e.distance||0;this._index=e.index||0;this._points=e.points.slice(0);this._planIndex=e.planIndex||0;this._rt=e.rt;if(this._distance===0&&this._points.length>2){this._points.length=2}}ev.extend(dh.prototype,{getNumSteps:function(){return this._steps.length},getStep:function(e){if(this._steps[e]){return this._steps[e]}},getDistance:function(e){if(e===false){return this._distance}else{return hU(this._distance)}},getIndex:function(){return this._index},getPolyline:function(){return this._polyline},getPath:function(){return this._points},getRouteType:function(){return this._rt},getPlanIndex:function(){return this._planIndex}});function i0(e){this["title"]=e.title;this.uid=e.uid;this["type"]=e.type;this._stops=e.stops.slice(0);this._points=e.points.slice(0);this._distance=e.distance||0;this._numViaStops=e.numViaStops||0;this._status=e.status||{}}ev.extend(i0.prototype,{getNumViaStops:function(){return this._numViaStops},getGetOnStop:function(){return this._stops[0]},getGetOffStop:function(){return this._stops[1]},getPath:function(){return this._points},getPolyline:function(){return this._polyline},getDistance:function(e){if(e===false){return this._distance}else{return hU(this._distance)}},getTitle:function(){return this["title"]}});function dn(e){this._path=e.path;this._point=e.point;this._index=e.index;this._description=e.description;this._distance=e.distance||0;this._routeIndex=e.routeIndex||0;this._planIndex=e.planIndex||0}ev.extend(dn.prototype,{getPosition:function(){return this._point},getIndex:function(){return this._index},getDescription:function(e){if(e===false){return by.removeHtml(this._description)}else{return this._description}},getDistance:function(e){if(e===false){return this._distance}else{return hU(this._distance)}},getRouteIndex:function(){return this._routeIndex},getPlanIndex:function(){return this._planIndex}});iO._genTitle=function(jf,jh,je){var i="-21px";var e="";if(je===0){e+=";border-top:1px solid #e4e6e7";i="5px"}var jg="nav-ed";if(je===0){jg="nav-st"}var T=["<div style=\'"+e+"\'><div style=\'cursor:pointer;padding:8px 0 8px 10px;line-height:15px\'"];T.push("onclick=\'"+jh+"\'>");T.push("<span class=\'navtrans-navlist-icon "+jg+"\'></span>");T.push("<div style=\'overflow:hidden;line-height:20px;\'>"+jf);T.push("</div></div></div>");return T.join("")};iO._genResultTitle=function(T,i,e){return\'<h1 style="margin:0;border-top:1px solid #e4e6e7;\'+(e?"border-bottom:1px solid #e4e6e7;padding:10px 0 10px 7px;":"padding:10px 0 9px 7px;")+"font:bold 16px "+w.fontFamily+\'"> \'+i+"前往 "+T+" 的路线</h1>"};ev.extend(iO.prototype,{search:function(i,e){if(!i||!e){this.clearResults();this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(az.CBK_SEARCH_COMPLETE);return false}return true},clearResults:function(){delete this._results;delete this._ud;delete this._json;delete this._boundsPoints;delete this._segPolylinePoints;var e=this._opts.renderOptions;this._setStatus();if(e.panel){e.panel.innerHTML=""}if(e.map){e.map.closeInfoWindow()}this._clearOverlays();this._curIndex=-1},_formatDestQuery:function(i,T){var e;T=T||{};if(typeof i==="string"){e=[2,"","",i,0,""]}else{if(i instanceof cf||i instanceof b9){var je=ig.convertLL2MC(i);e=[1,"",je.lng+","+je.lat,(T.wd||""),0,""]}else{var je=ig.convertLL2MC(i.point);e=[1,""+i.uid,je.lng+","+je.lat,i.title,0,""]}}return e.join("$$")+"$$"},_formatDestQuery30:function(i,T){var e;T=T||{};if(typeof i==="string"){e=i}else{if(i instanceof cf||i instanceof b9){e=i.lat.toFixed(6)+","+i.lng.toFixed(6)}else{var je=i.point;e=je.lat.toFixed(6)+","+je.lng.toFixed(6)}}return e},_formatDestUri:function(T,i){var e;if(typeof T==="string"){e=T}else{if(T instanceof cf||T instanceof b9){var je=T;e=je.lat+","+je.lng}else{var je=T.point;e=je.lat+","+je.lng}}if(typeof T!=="string"&&i&&i!==""&&typeof(i)==="string"){e="name:"+i+"|latlng:"+e}return e},getTPointQueryParam:function(e){var je="";var T="1";var i=this._formatDestQuery(e);return i+je+"$$"+T+"$$"},_getUriByOptions:function(i){var e;i=i||{};if(typeof dest==="string"){e=dest}else{if(dest instanceof cf||dest instanceof b9){var T=dest;e=T.lat+","+T.lng}else{var T=dest.point;e=T.lat+","+T.lng}}return e}});var c4=0;var ha=1;function hU(e){if(typeof e==="string"){e=parseFloat(e)}var i;if(!e||e<0){i="0米"}else{if(e<=10){i="10米"}else{i=e<1000?Math.round(e/10)*10+"米":(e/1000).toFixed(1)+"公里"}}if(i==="1000米"){i="1.0公里"}return i}function ay(jj,je){if(jj===0){jj=1}if(!jj||isNaN(jj)){return""}var e="";var i=60;var jf=i*24;var T=Math.ceil(jj/i);if(je==="bustime"){var ji=T%10;var jg=parseInt(T/10,10);T=ji!==0?(ji>5?(++jg*10):jg?(jg*10):5):T}var jk=parseInt(T/jf,10);T%=jf;var jh=parseInt(T/i,10);T%=i;if(jk>=1){e+=jk+"天"}if(jh>=1){e+=jh+"小时"}if(T>=1){if(je&&je==="nav"&&jk>=1){return e}else{e+=T+"分钟"}}return e}function ah(e){var T=e.getSouthWest();var i=e.getNorthEast();return[T,i]}ev.extend(ek.prototype,{_asyncSearch:function(){for(var T=0,e=this._queryList.length;T<e;T++){var jf=this._queryList[T];this[jf.method].apply(this,jf.arguments)}delete this._queryList;var je=this;if(this._opts.renderOptions.map){this._opts.renderOptions.map.addEventListener("onpoiselected",function(i){je.preciseSearch(i)})}},_internalSearch:function(je,e){var i=this;function T(jh){var jf=jh.split("$$");var jg=jf[0];var ji=null;if(/[0-2]/.test(jg)&&jf.length===7){ji=jf[+jg+1]}return ji}this._getIdByLoc(this._loc,function(ji){var jg={qt:i.QUERY_TYPE,c:ji,sn:je,en:e,sy:i._opts.policy||0,ext:1};if(jg.sy===BMAP_TRANSIT_POLICY_AVOID_SUBWAYS){jg.f="[0,2,4,7,5,8,9,10,11]"}var jh=T(je);var jf=T(e);iZ.request(function(jk,jj){i._rawDataCbk(jk,jj)},jg,{start:jh,end:jf})})},search:function(T,e){if(iO.prototype.search.call(this,T,e)===true){var i=this;this._getIdByLoc(this._loc,function(jg){if(!jg){this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(az.CBK_SEARCH_COMPLETE);return}if(typeof e==="string"||typeof T==="string"){i._setStatus(BMAP_STATUS_INVALID_REQUEST);i._triggerCbk(az.CBK_SEARCH_COMPLETE);return}else{var jf;jf={output:"json",qt:iX,};jf.origin=i._formatDestQuery30(T);jf.destination=i._formatDestQuery30(e);jf.mode="transit";jf.tactics_incity=i._opts.policy||0;jf.trans_type_intercity=i._opts.transitTypePolicy||0;jf.tactics_intercity=i._opts.intercityPolicy||0}var je={start:T,end:e,_from:"search",policy:jf.tactics_incity,intercityPolicy:jf.tactics_intercity,transitTypePolicy:jf.trans_type_intercity};iZ.request(function(ji,jh){i._rawDataCbk(ji,jh)},jf,je)})}},preciseSearch:function(je){if(je.sType!==this.QUERY_TYPE){return}var jf=je.paramInfo;jf.qt=this.QUERY_TYPE;var T=this;jf.sy=T._opts.policy||0;var i={start:jf.sq,end:jf.eq,_from:"preciseSearch"};if(this._opts._enableTraffic){i.reqURL=w.mapHost+"mobile/webapp/interface/wiseBus/";i.enableTraffic=true}iZ.request(function(jg,e){T._rawDataCbk(jg,i)},jf,i)},_rawDataCbk:function(i,e){var jf=this._opts.renderOptions.map;this.clearResults();this._json=i;var je=i.result;var jg=i.content;this._ud=e;if(je.error!==0){this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(az.CBK_SEARCH_COMPLETE,{})}else{if(jg.status!==0){this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(az.CBK_SEARCH_COMPLETE,{})}else{if(jg.type===ci){this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(az.CBK_SEARCH_COMPLETE,{})}else{if(jg.type===hw){var T=jg.result;if(T.routes===null||T.routes.length===0){this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(az.CBK_SEARCH_COMPLETE,{});return}if(T.origin["city_id"]===T.destination["city_id"]||T.origin["city_name"]===T.destination["city_name"]){this._json.content["transitType"]=BMAP_TRANSIT_TYPE_IN_CITY;this._processRawInCity()}else{this._json.content["transitType"]=BMAP_TRANSIT_TYPE_CROSS_CITY;this._processRawCrossCity()}this._renderList();this["_selectPlan"](0);return}}}}return},_getRouteStatus:function(T,i){var e=BMAP_ROUTE_STATUS_NORMAL;if(i===0){if(T>0){e=BMAP_ROUTE_STATUS_ADDRESS}else{e=BMAP_ROUTE_STATUS_EMPTY}}return e},_processRawInCity:function(){var jG=this;var jD=this._json.content;var jw=jD.result;var jl={};var jj={};if(typeof this._ud.start==="object"&&!(this._ud.start instanceof cf||this._ud.start instanceof b9)){ev.extend(jl,this._ud.start)}else{jl.title="起点";jl.city=jw.origin["city_name"];jl.point=new cf(jw.origin["location"]["lng"],jw.origin["location"]["lat"])}if(typeof this._ud.end==="object"&&!(this._ud.end instanceof cf||this._ud.end instanceof b9)){ev.extend(jj,this._ud.end)}else{jj.title="终点";jj.city=jw.destination["city_name"];jj.point=new cf(jw.destination["location"]["lng"],jw.destination["location"]["lat"])}var jp=jD.result["routes"];var jC=[];var ju=0;this._boundsPoints=[];for(var jz=0;jz<jp.length;jz++){if(ju>this._opts.pageCapacity-1){break}this._boundsPoints[ju]=[];var jB="<table class=\'trans-plan-content\'>";var jn=jp[jz];var jk=jn.distance;var e=jn.duration;var je="";var jA=jn.steps;var jq=0;var jx=0;var jF=[];var jo=[];var jm=[];var jf=[];for(var jy=0;jy<jA.length;jy++){var jv=jA[jy][0];var jh=[];jh.push(new cf(jv.start_location["lng"],jv.start_location["lat"]));jh=jh.concat(by.pathToPoints(jv.path));jh.push(new cf(jv.end_location["lng"],jv.end_location["lat"]));if(jv.vehicle_info["type"]===aN){var jE=new dh({distance:jv.distance,points:jh,rt:BMAP_ROUTE_TYPE_WALKING,index:jq,planIndex:jz});jq++;jF.push(jE);jm.push(jE);var ji="";if(jy===jA.length-1){ji=jj.title}else{ji=jA[jy+1][0]["vehicle_info"]["detail"]["on_station"]}jB+="<tr><td><span class=\'navtrans-bus-icon walk\'></span><div class=\'navtrans-bus-desc\'>步行约"+hU(jv.distance)+"，到达<span class=\'navtrans-busstation\'>"+ji+"</span></div></td></tr>";jf.push(BMAP_TRANSIT_PLAN_TYPE_ROUTE)}else{if(jv.vehicle_info["type"]===hx){var jr=jv.vehicle_info["detail"];var js={title:jr.on_station,point:new cf(jv.start_location["lng"],jv.start_location["lat"])};var jg={title:jr.off_station,point:new cf(jv.end_location["lng"],jv.end_location["lat"])};var jt=new i0({title:jr.name,distance:jv.distance,points:jh,stops:[js,jg],type:this._getLineType(jr.type,false),numViaStops:jr.stop_num});jo.push(jt);jm.push(jt);jB+="<tr><td><span class=\'navtrans-bus-icon bus\'></span><div class=\'navtrans-bus-desc\'>乘坐<span class=\'navtrans-busstation\'>"+jr.name+"</span>，经过"+jr.stop_num+"站，到达<span class=\'navtrans-busstation\'>"+jg.title+"</span></div></td></tr>";jf.push(BMAP_TRANSIT_PLAN_TYPE_LINE)}}}jB+="</table>";var T=new eb({routes:jF,lines:jo,total:jm,distance:jk,duration:e,description:jB,totalType:jf});jC.push(T);ju++}this._results=new dc({plans:jC,start:jl,end:jj,url:"",transitType:this._json.content["transitType"],intercityPolicy:this._ud.intercityPolicy,transitTypePolicy:this._ud.transitTypePolicy,policy:this._ud.policy});this._setStatus(BMAP_STATUS_SUCCESS);this._triggerCbk(az.CBK_SEARCH_COMPLETE,this._results);return},_processRawCrossCity:function(){var jI=this;var jF=this._json.content;var jx=jF.result;var jl={};var jj={};if(typeof this._ud.start==="object"&&!(this._ud.start instanceof cf||this._ud.start instanceof b9)){ev.extend(jl,this._ud.start)}else{jl.title="起点";jl.city=jx.origin["city_name"];jl.point=new cf(jx.origin["location"]["lng"],jx.origin["location"]["lat"])}if(typeof this._ud.end==="object"&&!(this._ud.end instanceof cf||this._ud.end instanceof b9)){ev.extend(jj,this._ud.end)}else{jj.title="终点";jj.city=jx.destination["city_name"];jj.point=new cf(jx.destination["location"]["lng"],jx.destination["location"]["lat"])}var jq=jF.result["routes"];var jE=[];var jv=0;this._boundsPoints=[];for(var jB=0;jB<jq.length;jB++){if(jv>this._opts.pageCapacity-1){break}this._boundsPoints[jv]=[];var jD="<table class=\'trans-plan-content\'>";var jn=jq[jB];var jk=jn.distance;var e=jn.duration;var je="";var jC=jn.steps;var jr=0;var jz=0;var jH=[];var jo=[];var jm=[];var jf=[];for(var jA=0;jA<jC.length;jA++){for(var jy=0;jy<jC[jA].length;jy++){var jw=jC[jA][jy];var jh=[];jh.push(new cf(jw.start_location["lng"],jw.start_location["lat"]));jh=jh.concat(by.pathToPoints(jw.path));jh.push(new cf(jw.end_location["lng"],jw.end_location["lat"]));if(jw.vehicle_info["type"]===aN){var jG=new dh({distance:jw.distance,points:jh,rt:BMAP_ROUTE_TYPE_WALKING,index:jr,planIndex:jB});jr++;jH.push(jG);jm.push(jG);var ji="";if(jA===jC.length-1&&jy===jC[jA].length-1){ji=jj.title}else{if(jA<jC.length-1&&jy===jC[jA].length-1){var jp=jC[jA+1][0]["vehicle_info"];switch(jp.type){case hx:ji=jp.detail["on_station"];break;case ab:case hv:case cv:ji=jp.detail["departure_station"];break}}else{if(jy<jC[jA].length-1){var jp=jC[jA][jy+1]["vehicle_info"];switch(jp.type){case hx:ji=jp.detail["on_station"];break;case ab:case hv:case cv:ji=jp.detail["departure_station"];break}}}}jD+="<tr><td><span class=\'navtrans-bus-icon walk\'></span><div class=\'navtrans-bus-desc\'>步行约"+hU(jw.distance)+"，到达<span class=\'navtrans-busstation\'>"+ji+"</span></div></td></tr>";jf.push(BMAP_TRANSIT_PLAN_TYPE_ROUTE)}else{if(jw.vehicle_info["type"]===hx){var js=jw.vehicle_info["detail"];var jt={title:js.on_station,point:new cf(jw.start_location["lng"],jw.start_location["lat"])};var jg={title:js.off_station,point:new cf(jw.end_location["lng"],jw.end_location["lat"])};var ju=new i0({title:js.name,distance:jw.distance,points:jh,stops:[jt,jg],type:this._getLineType(js.type),numViaStops:js.stop_num});jo.push(ju);jm.push(ju);jD+="<tr><td><span class=\'navtrans-bus-icon bus\'></span><div class=\'navtrans-bus-desc\'>乘坐<span class=\'navtrans-busstation\'>"+js.name+"</span>，经过"+js.stop_num+"站，到达<span class=\'navtrans-busstation\'>"+jg.title+"</span></div></td></tr>";jf.push(BMAP_TRANSIT_PLAN_TYPE_LINE)}else{if(jw.vehicle_info["type"]===ab){var js=jw.vehicle_info["detail"];var jt={title:js.departure_station,point:new cf(jw.start_location["lng"],jw.start_location["lat"])};var jg={title:js.arrive_station,point:new cf(jw.end_location["lng"],jw.end_location["lat"])};var ju=new i0({title:js.name,distance:jw.distance,points:jh,stops:[jt,jg],type:this._getLineType(jw.vehicle_info["type"],true)});jo.push(ju);jm.push(ju);jD+="<tr><td><span class=\'navtrans-cross-city-icon train\'></span><div class=\'navtrans-bus-desc\'>乘坐<span class=\'navtrans-busstation\'>"+js.name+"</span>到达<span class=\'navtrans-busstation\'>"+jg.title+"</span></div></td></tr>";jf.push(BMAP_TRANSIT_PLAN_TYPE_LINE)}else{if(jw.vehicle_info["type"]===hv){var js=jw.vehicle_info["detail"];var jt={title:js.departure_station,point:new cf(jw.start_location["lng"],jw.start_location["lat"])};var jg={title:js.arrive_station,point:new cf(jw.end_location["lng"],jw.end_location["lat"])};var ju=new i0({title:js.name,distance:jw.distance,points:jh,stops:[jt,jg],type:this._getLineType(jw.vehicle_info["type"],true)});jo.push(ju);jm.push(ju);jD+="<tr><td><span class=\'navtrans-cross-city-icon airplane\'></span><div class=\'navtrans-bus-desc\'>乘坐<span class=\'navtrans-busstation\'>"+js.name+"</span>到达<span class=\'navtrans-busstation\'>"+jg.title+"</span></div></td></tr>";jf.push(BMAP_TRANSIT_PLAN_TYPE_LINE)}else{if(jw.vehicle_info["type"]===cv){var js=jw.vehicle_info["detail"];var jt={title:js.departure_station,point:new cf(jw.start_location["lng"],jw.start_location["lat"])};var jg={title:js.arrive_station,point:new cf(jw.end_location["lng"],jw.end_location["lat"])};var ju=new i0({title:js.name,distance:jw.distance,points:jh,stops:[jt,jg],type:this._getLineType(jw.vehicle_info["type"],true)});jo.push(ju);jm.push(ju);jD+="<tr><td><span class=\'navtrans-bus-icon bus\'></span><div class=\'navtrans-bus-desc\'>乘坐<span class=\'navtrans-busstation\'>"+js.name+"</span>到达<span class=\'navtrans-busstation\'>"+jg.title+"</span></div></td></tr>";jf.push(BMAP_TRANSIT_PLAN_TYPE_LINE)}else{if(jw.vehicle_info["type"]===dH){var jG=new dh({distance:jw.distance,points:jh,rt:BMAP_ROUTE_TYPE_DRIVING,index:jr,planIndex:jB});jr++;jH.push(jG);jm.push(jG);jD+="<tr><td><span class=\'navtrans-bus-icon drive\'></span><div class=\'navtrans-bus-desc\'>驾车约"+hU(jw.distance)+"</div></td></tr>";jf.push(BMAP_TRANSIT_PLAN_TYPE_ROUTE)}}}}}}}}jD+="</table>";var T=new eb({routes:jH,lines:jo,total:jm,distance:jk,duration:e,description:jD,totalType:jf});jE.push(T);jv++}this._results=new dc({plans:jE,start:jl,end:jj,url:"",transitType:this._json.content["transitType"],policy:this._ud.policy,intercityPolicy:this._ud.intercityPolicy,transitTypePolicy:this._ud.transitTypePolicy});this._setStatus(BMAP_STATUS_SUCCESS);this._triggerCbk(az.CBK_SEARCH_COMPLETE,this._results);return},_renderPlan:function(jf){var ju=this._opts.renderOptions.map;var e=[];var jw=this;if(!ju){return}var T=this._results.getPlan(jf);if(!T){return}var je=this._results.getStart();var js=this._results.getEnd();var jo=e6.addDestPoi(ju,je.point,je.title,c4);je.marker=jo;jo.addEventListener("click",function(){jw._select(0)});this._overlays.push(jo);var jm=e6.addDestPoi(ju,js.point,js.title,ha);js.marker=jm;this._overlays.push(jm);jm.addEventListener("click",function(){jw._selectLast()});var jk=je.point;var jr=js.point;this._boundsPoints[jf].push(jk,jr);for(var jq=0,jn=T.getNumTotal(),jp=0;jq<jn;jq++){if(T.getTotalType(jq)===BMAP_TRANSIT_PLAN_TYPE_LINE){var jj=T.getTotal(jq);var jl=e6.addLine(ju,jj.getPath());jj._polyline=jl;this._overlays.push(jl);var jh=jj.getGetOnStop();e.push(jh);var ji=e6.addTransPoi(ju,jh.point,jj.type,jh.title);jh.marker=ji;this._overlays.push(ji);var jv=jj.getGetOffStop();e.push(jv);var jg=e6.addTransPoi(ju,jv.point,jj.type,jv.title);jv.marker=jg;(function(){var i=jp;jp=jp+1;ji.addEventListener("click",function(){jw._select((i+1)*2-1)});jg.addEventListener("click",function(){jw._select((i+1)*2)})})();this._overlays.push(jg);this._boundsPoints[jf].push(jh.point,jv.point)}else{if(T.getTotalType(jq)===BMAP_TRANSIT_PLAN_TYPE_ROUTE){var jt=T.getTotal(jq);jl=e6.addRoute(ju,jt.getPath(),jt.getRouteType());jt._polyline=jl;this._overlays.push(jl)}}}var jw=this;if(this._opts.renderOptions.autoViewport){ju.setViewport(this._boundsPoints[jf],{margins:[30,30,30,30]})}this._triggerCbk(az.CBK_POLYLINES_SET,T._lines,T._routes);this._triggerCbk(az.CBK_MARKERS_SET,[je,js],e)},_renderList:function(){if(this._opts.renderOptions.panel&&this._opts.renderOptions.panel.appendChild&&this._results&&this._results.getNumPlans()>0){var T=bL("div",{style:"font:12px "+w.fontFamily+";background:#fff"});var jp=iO._genResultTitle(this._results.getEnd()["title"],"乘公共交通工具");var jj=this._genTitleHtml(this._results.getStart()["title"],\'BMapGL.I("\'+this.hashCode+\'")["_select"](0)\',0);var jf=this._genTitleHtml(this._results.getEnd().title,\'BMapGL.I("\'+this.hashCode+\'")["_selectLast"]()\',1);var jq=["<table style=\'font:12px "+w.fontFamily+";border-collapse:collapse;width:100%;\' cellpadding=\'0\' cellspacing=\'0\' border=\'0\'>"];for(var jm=0,jk=this._results.getNumPlans();jm<jk;jm++){var jo=this._results.getPlan(jm);var jh=jo.getDistance().replace(/(\\d+(?:.\\d+)?)/,"$1 ");var e=jo.getDuration().replace(/(\\d+)/,"$1 ");var ji=jo.getWalkDistance();bg="";var jn="<p style=\'margin:0px 0px 5px 0px;font-size:14px;color: #36c;\'>"+jo.getLinesTitle()+"</p>";if(this._json.content["transitType"]===BMAP_TRANSIT_TYPE_IN_CITY){jh=jh+"  &nbsp;|&nbsp;  "}else{jh=""}var je="<p style=\'margin:5px 0px;font-size:12px;\'>"+jh+e+"  &nbsp;|&nbsp; 步行"+ji+"</p>";var jg="vertical-align:top;";jq.push("<tr class=\'tranroute-plan-list\' style=\\"cursor:pointer"+bg+\'">\');jq.push("<td style=\'"+jg+"line-height:18px\' ><div style=\'margin:3px 0px;border:1px solid #e4e6e7;\'><div class=\'trans-title\' style=\'padding: 5px 10px;\' onclick=\'BMapGL.I(\\""+this.hashCode+\'")._selectPlan(\'+jm+")\'>"+jn+je+"</div><div class=\'trans_plan_desc\' style=\'padding:0px 8px;margin:0px;display:none;position:relative;\'>"+jj+jo.getDescription()+jf+"</div></div></td>");jq.push("</tr>")}jq.push("</table>");var jl="<div style=\'border-bottom:1px solid #ccc;margin-bottom:10px;color:#7777cc;background:#e5ecf9;overflow:hidden;padding:2px;text-align:right\'>";if(this._results.moreResultsUrl){jl+="<a style=\'color:#7777cc\' href=\'"+this._results.moreResultsUrl+"\' target=\'_blank\'>到百度地图查看&#187;</a>"}jl+="&nbsp;</div>";T.innerHTML=jp+jq.join("")+jl;this._opts.renderOptions.panel.appendChild(T);this._triggerCbk(az.CBK_RESULTS_HTML_SET,T)}},_select:function(jh,jj){var T=this._opts.renderOptions.map;if(T){jj=jj||window.event;var jm=this._results.getPlan(this._curIndex);if(!jm){return}var jl=this;var jn=jm.getNumLines()*2;if(jh===0||jh===jn+1){var jk=jh===0?this._results.getStart():this._results.getEnd();var jf=e6.createTransInfoWnd({content:"<b>"+jk.title+"</b>",total:jn,curIndex:jh,nextTransCbk:function(e){jl._select(e)}});jf.addEventListener("open",function(){jl._triggerCbk(az.CBK_INFO_HTML_SET,jk,e6.getInfoWindowDom(T))});var ji=jh===0?0:1;var jl=this;if(T.config.enableStreetEntrance&&false){PanoramaEntranceUtil.insearchPanoEntranceInInfoWnd(jf,T.getCurrentCity().code,{panoInstance:T._pano,lngLat:jk.point,titleTip:jk.title,type:"busline",beforeDomId:"trans_nav"},function(){jl._overlays[ji].openInfoWindow(jf)})}else{jl._overlays[ji].openInfoWindow(jf)}}else{var i=jm.getLine(Math.floor((jh+1)/2)-1);var jo;var je=i.getTitle();var jg;if(jh%2===1){jo=i.getGetOnStop();jg=je+"<b>"+jo.title+"上车</b>"}else{jo=i.getGetOffStop();jg=je+"<b>"+jo.title+"下车</b>"}var jf=e6.createTransInfoWnd({content:jg,total:jn,curIndex:jh,nextTransCbk:function(e){jl._select(e)}});jf.addEventListener("open",function(){jl._triggerCbk(az.CBK_INFO_HTML_SET,jo,e6.getInfoWindowDom(T))});var jl=this;if(T.config.enableStreetEntrance&&false){PanoramaEntranceUtil.insearchPanoEntranceInInfoWnd(jf,T.getCurrentCity().code,{panoInstance:T._pano,lngLat:jo.point,titleTip:jo.title,type:"busline",beforeDomId:"trans_nav"},function(){jo.marker.openInfoWindow(jf)})}else{jo.marker.openInfoWindow(jf)}}}},_selectLast:function(je){je=je||window.event;if(this._results&&this._curIndex>-1){var T=this._results.getPlan(this._curIndex);if(!T){return}var i=T.getNumLines()*2;this["_select"](i+1)}},_selectPlan:function(jg){if(!this._results&&!this._result.getPlan(jg)){return}var jj=this._results.getPlan(jg);var e=this._opts.renderOptions.map;if(e){e.closeInfoWindow();this._clearOverlays();this._renderPlan(jg)}if(this._opts.renderOptions.panel){var jk=this._opts.renderOptions.panel.getElementsByTagName("table")[0];if(!jk){return}var jh=ev.getElementsByClassName(jk,"tranroute-plan-list");var ji=ev.getElementsByClassName(jk,"trans_plan_desc");for(var je=0;je<ji.length;je++){if(je!==jg){ji[je].style.display="none"}}for(var T=0;T<jh.length;T++){ev.removeClassName(jh[T],"expand")}var jf=ev.getElementsByClassName(jh[jg],"trans_plan_desc")[0];if(jf.style.display==="none"){jf.style.display="block";ev.addClassName(jh[jg],"expand")}else{jf.style.display="none"}}this._curIndex=jg},_clearOverlays:function(){for(var e=0;e<this._overlays.length;e++){if(this._overlays[e]&&this._overlays[e]._p){this._overlays[e]._p.remove();this._overlays[e]._p=null}this._overlays[e]&&this._overlays[e].remove();this._overlays[e]=null}this._overlays.length=0},_getLineType:function(i,e){if(!e){return ek.LINE_TYPE_MAPPING[i]}else{return ek.LINE_TYPE_MAPPING_CROSS_CITY[i]}},_genTitleHtml:function(je,jg,T){var i="";if(T===0){i+="padding-top:5px;"}var jf="nav-ed";if(T===0){jf="nav-st"}var e=["<div style=\'"+i+"\'><div style=\'cursor:pointer;padding:2px 0 2px 0px;line-height:15px\'"];e.push("onclick=\'"+jg+"\'>");e.push("<span class=\'navtrans-navlist-icon "+jf+"\'></span>");e.push("<div style=\'overflow:hidden;line-height:20px;\'>"+je);e.push("</div></div></div>");return e.join("")}});ck.MAX_THRESHOLD=20;ck.DRAG_REQ_FREQUENCE=50;ck.DRAG_MAXPOINTS=10;ev.extend(ck.prototype,{init_d:function(){this._d={plys:[],viaPts:[],viaPtsInfo:[],dragOverlays:[],tipLbl:null,sliderMkr:null,dragReqFlag:false,cbkDragPt:null,cbkPly:null,isSearchByDrag:false,curDragPly:null,dragSrcCityCode:1,dragEndCityCode:1,cbkStartPoiName:"起点",cbkEndPoiName:"终点",mouseOnViaMkr:false,cxtMenu:[]}},_asyncSearch:function(){this.init_d();for(var T=0,e=this._queryList.length;T<e;T++){var jf=this._queryList[T];this[jf.method].apply(this,jf.arguments)}delete this._queryList;var je=this;if(this._opts.renderOptions.map){this._opts.renderOptions.map.addEventListener("onpoiselected",function(i){je.preciseSearch(i)})}},search:function(je,e,T){this._d.isSearchByDrag=false;var T=T||{};if(iO.prototype.search.call(this,je,e)===true){var i=this;this._getIdByLoc(this._loc,function(ji){ji=ji||1;var jh;jh={output:"json",qt:iX,};var jf={start:je,end:e};var jg="";if(i.QUERY_TYPE===ho){jh.origin=i._formatDestQuery30(je);jh.destination=i._formatDestQuery30(e);jh.region=ji;jh.mode="walking"}else{if(i.QUERY_TYPE===aF){if(typeof e==="string"||typeof je==="string"){i._setStatus(BMAP_STATUS_INVALID_REQUEST);i._triggerCbk(az.CBK_SEARCH_COMPLETE,{});return}else{jh.origin=i._formatDestQuery30(je);jh.destination=i._formatDestQuery30(e);jh.mode="driving";jh.tactics=i._opts.policy||0;jf.policy=jh.tactics}}else{if(i.QUERY_TYPE===gP){jh.origin=i._formatDestQuery30(je);jh.destination=i._formatDestQuery30(e);jh.region=ji;jh.mode="riding"}}}iZ.request(function(jk,jj){i._rawDataCbk(jk,jj)},jh,jf,jg)})}},_dragSearch:function(T,e){var i=this;i._d.isSearchByDrag=true;i._getIdByLoc(i._loc,function(jf){jf=jf||1;var jj=ig.convertLL2MC(i._d.viaPts[0]);var je="1$$$$"+jj.lng+","+jj.lat+"$$$$";var jn=i._d.dragSrcCityCode||jf;var jm="";var jg="";for(var jk=1,jh=i._d.viaPts.length;jk<jh;jk++){var jl=i._d.viaPts[jk];if(jk===jh-1){jm+=i._formatDestQuery(jl);jg+=(i._d.dragEndCityCode||jf)}else{if(jl.if_wp){jm+=i.getTPointQueryParam(jl)+"+to:"}else{jm+=i._formatDestQuery(jl)+"+to:"}jg+="0 +to:"}}var ji={qt:i.QUERY_TYPE,c:jf,drag:1,sc:jn,ec:jg,sn:je,en:jm,sy:i._opts.policy||0};if(i._opts._enableTraffic){ji.route_traffic=1;ji.version=4;ji.mrs=0}var jo={start:T,end:e,enableTraffic:i._opts._enableTraffic};ev.extend(jo,{useEncodeURI:true});iZ.request(function(jq,jp){i._rawDataCbk(jq,jp)},ji,jo)})},preciseSearch:function(je){var T=this;var jf={};jf.qt=iX;if(T.QUERY_TYPE===ho){jf.origin=je.paramInfo["start_name"];jf.destination=je.paramInfo["end_name"];jf.region=je.paramInfo["region"];jf.mode="walking"}if(T.QUERY_TYPE===gP){jf.origin=je.paramInfo["start_name"];jf.destination=je.paramInfo["end_name"];jf.region=je.paramInfo["region"];jf.mode="riding"}var i={start:jf.origin,end:jf.destination};iZ.request(function(jg,e){T._rawDataCbk(jg,i)},jf,i)},_rawDataCbk:function(jj,T){this.clearResults();this._json=jj;var e=jj.result;var jg=jj.content;this._ud=T;if(e.error!==0){this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(az.CBK_SEARCH_COMPLETE,{})}else{if(jg.status!==0||(jg.result&&jg.result["routes"]===null)){this._setStatus(BMAP_STATUS_INVALID_REQUEST);this._triggerCbk(az.CBK_SEARCH_COMPLETE,{})}else{if(jg.type===ci){if(this.QUERY_TYPE===ho||this.QUERY_TYPE===gP){var je=jg.result;var jf;var jh;jf=this._getRouteStatus30(je.origin["content"]);jh=this._getRouteStatus30(je.destination["content"]);if(jf!=BMAP_ROUTE_STATUS_EMPTY&&jh!=BMAP_ROUTE_STATUS_EMPTY&&this._opts.renderOptions.map){var ji=new gz(jj,{renderOptions:this._opts.renderOptions,sType:this.QUERY_TYPE});var i=bL("div",{style:"font:12px "+w.fontFamily+";background:#fff"});i.innerHTML=ji.render(T);if(this._opts.renderOptions.panel){this._opts.renderOptions.panel.appendChild(i);ji.initialize();return}else{ji.withoutPanelInitial();return}}this._results=this._createResults({city:"",plans:[],startStatus:jf,endStatus:jh});this._setStatus(BMAP_STATUS_UNKNOWN_ROUTE);this._triggerCbk(az.CBK_SEARCH_COMPLETE,this._results);return}else{if(this.QUERY_TYPE===aF){}}}else{if(jg.type===hw){if(this.QUERY_TYPE===aF){this._opts.renderOptions.panel=null}this._processRaw();this._renderMap();if(this.QUERY_TYPE===ho||this.QUERY_TYPE===gP){this._renderList()}}}}}},_getRouteStatus:function(T,i){var e=BMAP_ROUTE_STATUS_NORMAL;if(i===0){if(T>0){e=BMAP_ROUTE_STATUS_ADDRESS}else{e=BMAP_ROUTE_STATUS_EMPTY}}return e},_getRouteStatus30:function(i){var e=BMAP_ROUTE_STATUS_NORMAL;if(typeof i==="undefined"||i===null||i.length===0){e=BMAP_ROUTE_STATUS_EMPTY}else{if(i.length>0){e=BMAP_ROUTE_STATUS_ADDRESS}}return e},_stopDragging:function(){var jf=this;if(jf._d.sliderMkr){jf._d.sliderMkr.disableDragging()}for(var je=0,e=this._d.dragOverlays.length;je<e;je++){var T=this._d.dragOverlays[je];if(T instanceof iU){T.disableDragging()}}},_processRaw:function(){var jH=this;var jG=this._json.content;var jt=jG.result;var jj={};var jh={};if(typeof this._ud.start==="object"&&!(this._ud.start instanceof cf||this._ud.start instanceof b9)){ev.extend(jj,this._ud.start)}else{if(jH.QUERY_TYPE===ho||jH.QUERY_TYPE===gP){jj.title=jt.origin["wd"]||"起点";jj.uid=jt.origin["uid"];jj.url=az._getPoiUrl(jj.uid,jt.origin["area_id"]);jj.point=new cf(jt.origin["originPt"]["lng"],jt.origin["originPt"]["lat"]);jj.city=jt.origin["cname"]}else{if(jH.QUERY_TYPE===aF){jj.title="起点";jj.point=new cf(jt.routes[0]["origin"]["lng"],jt.routes[0]["origin"]["lat"])}}}if(typeof this._ud.end==="object"&&!(this._ud.end instanceof cf||this._ud.end instanceof b9)){ev.extend(jh,this._ud.end)}else{if(jH.QUERY_TYPE===ho||jH.QUERY_TYPE===gP){jh.title=jt.destination["wd"]||"终点";jh.uid=jt.destination["uid"];jh.url=az._getPoiUrl(jh.uid,jt.destination["area_id"]);jh.point=new cf(jt.destination["destinationPt"]["lng"],jt.destination["destinationPt"]["lat"]);jh.city=jt.destination["cname"]}else{if(jH.QUERY_TYPE===aF){jh.title="终点";jh.point=new cf(jt.routes[0]["destination"]["lng"],jt.routes[0]["destination"]["lat"])}}}var jq=[];this._d.viaPtsInfo.length=0;var jC=1;var jF=[];this._segPolylinePoints=[];var jm=0;var jr=[];var jy=[];var jE=[];var jz=[];var jo=jt.routes;if(jH.QUERY_TYPE===ho||jH.QUERY_TYPE===gP){for(var jA=0;jA<jo.length;jA++){var ju=jo[jA];for(var jw=0;jw<1;jw++){var jB=ju.steps;for(j=0;j<jB.length;j++){var jv=new cf(jB[j]["stepOriginLocation"]["lng"],jB[j]["stepOriginLocation"]["lat"]);var js=j;var jk=jB[j]["instructions"];var jg=jB[j]["distance"];var jl=new dn({point:jv,index:js,description:jk,distance:jg});jE.push(jl);var jf=[];jf.push(jv);jf=jf.concat(by.pathToPoints(jB[j]["path"]));jf.push(new cf(jB[j]["stepDestinationLocation"]["lng"],jB[j]["stepDestinationLocation"]["lat"]));jz=jz.concat(jf);if(jf.length>0){this._segPolylinePoints[jm]=jf;jF=jF.concat(jf)}jm++}var jg=ju.distance;var e=new dh({steps:jE,distance:jg,index:jw,points:jz,rt:this.ROUTE_TYPE});jy.push(e)}var jn=new f2({routes:jy,distance:ju.distance,duration:ju.duration});jr.push(jn)}var jp={plans:jr,start:jj,end:jh}}else{if(jH.QUERY_TYPE===aF){for(var jA=0;jA<jo.length;jA++){var ju=jo[jA];for(var jw=0;jw<1;jw++){var jB=ju.steps;for(j=0;j<jB.length;j++){var jv=new cf(jB[j]["start_location"]["lng"],jB[j]["start_location"]["lat"]);var js=j;var jk="";var jg=jB[j]["distance"];var jl=new dn({point:jv,index:js,description:jk,distance:jg});jE.push(jl);var jf=[];jf=jf.concat(by.pathToPoints(jB[j]["path"]));jz=jz.concat(jf);if(jf.length>0){this._segPolylinePoints[jm]=jf;jF=jF.concat(jf)}jm++}var jg=ju.distance;var e=new dh({steps:jE,distance:jg,index:jw,points:jz,rt:this.ROUTE_TYPE});jy.push(e)}var jn=new f2({routes:jy,distance:ju.distance,duration:ju.duration});jr.push(jn)}var jp={plans:jr,start:jj,end:jh,policy:jH._ud.policy}}}this._results=this._createResults(jp);this._d.viaPts.length=0;this._d.plys.length=0;var T=jj.point;this._d.viaPts.push(T);for(var jA=0,jx=jq.length;jA<jx;jA++){var jD=jq[jA];this._d.viaPts.push(jD)}var je=jh.point;this._d.viaPts.push(je);var ji=jz;ji.stNo=jA;ji.edNo=jA+1;this._d.plys.push(ji);this._setStatus(BMAP_STATUS_SUCCESS);this._triggerCbk(az.CBK_SEARCH_COMPLETE,this._results)},_getAllStepCount:function(){var jf=0;var jg=this._results.getPlan(0);for(var je=0,e=jg.getNumRoutes();je<e;je++){var T=jg.getRoute(je);jf+=T.getNumSteps()}return jf},_getCurStep:function(jh){var jg=0;var ji=this._results.getPlan(0);for(var jf=0,T=ji.getNumRoutes();jf<T;jf++){var jk=ji.getRoute(jf);for(var je=0,jj=jk.getNumSteps();je<jj;je++){var e=jk.getStep(je);if(jg===jh){return e}jg++}}},_getDescription:function(jj,ji,jt,jp,jo,je,jx){var jg="";var jn=parseInt(ji.d,10);var jk=ji.poi;if(jk){jn=jn-jk.pd}var js=hU(jn);var T=this._getRoadName(je.t,je.n);var jf=this._getRoadName(ji.t,ji.n);var jw=this._getRoadName(ji.t,jt.n);var jl=this._getDwType(jj.dw)||"";var jm=jj.dr?(jl+"<span>"+jj.dr+"</span>，"):"";if(jx.rt===3){jm+="到达<span>"+this._getRetType(jx.rt)+"</span>，"}var ju=((jf!==""&&T===jf)?"继续":"")+this._getRoadAct(ji.t,ji.n);var e=this._getPoiInfo(ji);var jr=this._getTicInfo(jj);var jv=(jf===jw)?"":(this._getRetAct(jt.t,jt.n)+"<span>"+jw+"</span>");var jq=this._getTurnIcon(jj.ett||jj.extt||jj.tt);jg=jq+"<div class=\'navtrans-navlist-content\'>"+ju+jf+this._getRetType(jj.rt)+js+"，"+e+jr+jm;if(jp===0){jg=jq+"<div class=\'navtrans-navlist-content\'>从起点向"+this._getTurnType(jj.ett||jj.extt||jj.tt)+"出发</div>"}else{if(jp>0&&jp<jo-1){var jh=this._getTurnType(jj.ett||jj.extt||jj.tt);if(!jh){jh=this._getTurnType(1)}jg=jg+jh+jv+"</div>"}else{jg=jg+"到达终点</div>"}}return jg},_isInThreshold:function(ji,T,jh){if(T&&jh&&jh.length>0){for(var jg=0,e=jh.length;jg<e;jg++){var jf=jh[jg];var je=ji.pointToPixel(jf);if(e6.getDistanceByPixel(T,je)<=ck.MAX_THRESHOLD){return true}}}return false},_renderMap:function(){var e=this._opts.renderOptions.map;if(e&&this._results){this._renderViaMkr();this._renderPly()}},_renderPly:function(){var jw=this._opts.renderOptions.map;var e=this._results.getPlan(0);var jv=e.getRoute(0);var je=this._results.getStart();var ju=this._results.getEnd();var jx=this;var jg=this._d.viaPts.length;var jt=[];var ji=[];var T;for(var jq=0,jn=this._d.plys.length;jq<jn;jq++){var jl=this._d.plys[jq];T=e6.addRoute(jw,jl,jv.getRouteType());e._routes[jq]._polyline=T;T.stNo=jl.stNo;T.edNo=jl.edNo;var jo=T.getBounds();jt.push(jo.getSouthWest());jt.push(jo.getNorthEast());if(this._enableDragging){if(jg<ck.DRAG_MAXPOINTS+2){T.addEventListener("mousemove",function(i){if(jx._d.mouseOnViaMkr){if(jx._d.sliderMkr){jx._d.sliderMkr.hide()}return}jx._d.curDragPly=this;if(jx._d.sliderMkr){if(jx._isInThreshold(jw,i.pixel,jx._d.viaPts)){jx._d.sliderMkr.hide()}else{jx._d.sliderMkr.show();jx._d.sliderMkr.setPosition(i.point);jx._d.tipLbl.setContent("拖动以更改路线");jx._d.tipLbl.show();jx._d.sliderMkr.setLabel(jx._d.tipLbl)}}else{jx._d.sliderMkr=e6.addDragMkr(jw,i.point);jx._d.sliderMkr.enableDragging();jx._d.sliderMkr.addEventListener("dragging",function(jz){var jA=jx._d.curDragPly.stNo;var jy=jx._d.curDragPly.edNo;jx._requestDragging(this,jw,jA,jy)});jx._d.sliderMkr.addEventListener("dragend",function(jA){var jz=jx._d.cbkDragPt;var jB=jz.name;var jy=jx._d.curDragPly.edNo;jz.if_wp=null;jx._d.viaPts.splice(jy,0,jz);jx._d.viaPtsInfo.splice(jy,0,{title:!!jB?jB:"未知路段",curNo:jy,point:jz});this.setPosition(jz);jx._stopDragging();jx._dragSearch(je,ju)});if(!jx._d.tipLbl){jx._d.tipLbl=e6.createTipLbl("拖动以更改路线")}jw.addOverlay(jx._d.sliderMkr)}});T.addEventListener("mouseout",function(i){if(jx._d.sliderMkr){jx._d.sliderMkr.hide()}})}}jx._d.dragOverlays.push(T);if(this._opts._enableTraffic){jv=e.getRoute(jq);for(var jp=0,jj=jv._steps.length;jp<jj;jp++){var jf=jv._steps[jp];var jm=jf.trafficPaths;var jr=jf.trafficStatus;for(var jk=0,js=jm.length;jk<js;jk++){if(jr[jk]){var jh=e6.addRouteWithTraffic(jw,jm[jk],jr[jk])}ji.push(jh);jx._d.dragOverlays.push(jh)}}jv._trafficePlys=ji}}if(this._opts.renderOptions.autoViewport){jw.setViewport(jt,{margins:[30,30,30,30]})}this._triggerCbk(az.CBK_POLYLINES_SET,e._routes)},_renderViaMkr:function(){var T=this._opts.renderOptions.map;var jn=this._results.getPlan(0);var e=this._results.getStart();var jk=this._results.getEnd();var jl=this;var jm=0;for(var ji=0,je=this._d.viaPts.length;ji<je;ji++){var jj=this._d.viaPts[ji];var jg;if(ji===0){jg=e6.addDestPoi(T,jj,e.title,c4);e.marker=jg;if(this.QUERY_TYPE===ho||this.QUERY_TYPE===gP){jg.addEventListener("click",function(){jl._select(0)})}this._overlays.push(jg)}else{if(ji===this._d.viaPts.length-1){jg=e6.addDestPoi(T,jj,jk.title,ha);jk.marker=jg;if(this.QUERY_TYPE===ho||this.QUERY_TYPE===gP){jg.addEventListener("click",function(){jl._select(jl._getAllStepCount()+1)})}this._overlays.push(jg)}else{if(jj.if_wp){jg=e6.addWayPointMkr(T,jj,jm);jm++;jg.if_wp=1}else{jg=e6.addDragMkr(T,jj)}this._d.viaPtsInfo[ji-1].marker=jg;var jh=new gE();jh.addItem(new hd("删除该点",function(jp,jo,i){jl._delVia(i.curNo)},{width:60}));jg.addContextMenu(jh);jl._d.cxtMenu.push(jh)}}jg.curNo=ji;if(this._enableDragging){jg.enableDragging();jg.addEventListener("mouseover",function(i){jl._d.mouseOnViaMkr=true;if(jl._d.tipLbl){jl._d.tipLbl.setContent("拖动以更改路线");jl._d.tipLbl.show();this.setLabel(jl._d.tipLbl)}else{jl._d.tipLbl=e6.createTipLbl("拖动以更改路线");this.setLabel(jl._d.tipLbl)}});jg.addEventListener("mouseout",function(i){this.getLabel()&&this.getLabel().hide();jl._d.mouseOnViaMkr=false});jg.addEventListener("dragging",function(i){jl._requestDragging(this,T)});jg.addEventListener("dragend",function(jo){var i=jl._d.cbkDragPt;var jp=this.curNo;if(this.if_wp){i.if_wp=1}jl._d.viaPts[jp]=i;this.setPosition(i);var jr=jl._d.viaPts[0];var jq=jl._d.viaPts[jl._d.viaPts.length-1];if(jp===0){e.point=jr;e.title=jl._d.cbkStartPoiName}if(jp===jl._d.viaPts.length-1){jk.point=jq;jk.title=jl._d.cbkEndPoiName}jl._stopDragging();jl._dragSearch(e,jk)})}jl._d.dragOverlays.push(jg)}var jf=[e];jf=jf.concat(this._d.viaPtsInfo);jf=jf.concat([jk]);this._triggerCbk(az.CBK_MARKERS_SET,jf)},_requestDragging:function(ji,i,je,jj){var jl=this;if(jl._d.dragReqFlag===true){return}jl._d.dragReqFlag=true;setTimeout(function(){jl._d.dragReqFlag=false},ck.DRAG_REQ_FREQUENCE);var jg;var jn=ig.convertLL2MC(ji.getPosition());var e=i.getZoom();var jk=ji.curNo;var jm=jl._opts.policy;if(typeof je!=="undefiend"&&typeof jj!=="undefined"){var jf=jl._d.viaPts[je];jf=ig.convertLL2MC(jf);var jh=jl._d.viaPts[jj];jh=ig.convertLL2MC(jh);jg={qt:ht,pt:jn.lng+","+jn.lat,sn:jf.lng+","+jf.lat,en:jh.lng+","+jh.lat,r:5000,st:1,et:1,sy:jm,l:e}}else{if(jk===0){var jh=jl._d.viaPts[jk+1];jh=ig.convertLL2MC(jh);jg={qt:ht,pt:jn.lng+","+jn.lat,sn:"",en:jh.lng+","+jh.lat,r:5000,st:1,et:1,sy:jm,l:e}}else{if(jk===this._d.viaPts.length-1){var jf=jl._d.viaPts[jk-1];jf=ig.convertLL2MC(jf);jg={qt:ht,pt:jn.lng+","+jn.lat,sn:jf.lng+","+jf.lat,en:"",r:5000,st:1,et:1,sy:jm,l:e}}else{var jf=jl._d.viaPts[jk-1];jf=ig.convertLL2MC(jf);var jh=jl._d.viaPts[jk+1];jh=ig.convertLL2MC(jh);jg={qt:ht,pt:jn.lng+","+jn.lat,sn:jf.lng+","+jf.lat,en:jh.lng+","+jh.lat,r:5000,st:1,et:1,sy:jm,l:e}}}}var T={curDragMkr:ji,map:i,stNo:je,edNo:jj};iZ.request(function(jp,jo){jl._requestDraggingCbk(jp,jo)},jg,T)},_requestDraggingCbk:function(jn,T){var jj=this;if(jn&&jn.content){jj._d.cbkDragPt=by.parseGeo(jn.content["dragpt"],true).point;var jm;var i=T.map;var jf=T.stNo;var jh=T.edNo;var jg=T.curDragMkr;var ji=jg.curNo;if(typeof jf!=="undefiend"&&typeof jh!=="undefined"){jm=by.parseGeoExt(jn.content["geo"]).points}else{if(ji===0){jm=by.parseGeo(jn.content["geo"],true).points;jj._d.cbkStartPoiName=jn.content["name"]?jn.content["name"]:"起点"}else{if(ji===jj._d.viaPts.length-1){jm=by.parseGeo(jn.content["geo"],true).points;jj._d.cbkEndPoiName=jn.content["name"]?jn.content["name"]:"终点"}else{jm=by.parseGeoExt(jn.content["geo"]).points}}}if(jm){jj._clearOldLine(ji,i,jf,jh);if(jj._d.cbkPly){jj._d.cbkPly.setPath(jm)}else{var jk=jj._results.getPlan(0);var jl=jk.getRoute(0);jj._d.cbkPly=e6.addRoute(i,jm,jl.getRouteType())}}var e=jn.content["name"]?jn.content["name"]:"未知路段";jj._d.cbkDragPt.name=e;var je="("+hU(jn.content["dis"])+")";jj._d.tipLbl&&jj._d.tipLbl.show();jj._d.tipLbl&&jj._d.tipLbl.setContent(e+je)}},_clearOldLine:function(jh,ji,jg,T){for(var jf=0,e=this._d.dragOverlays.length;jf<e;jf++){var je=this._d.dragOverlays[jf];if(je instanceof fl){if(typeof jg!=="undefiend"&&typeof T!=="undefined"){if(je.stNo===jg&&je.edNo===T){ji.removeOverlay(je);break}}else{if(je.stNo===jh||je.edNo===jh){ji.removeOverlay(je)}}}}if(this._hlRoute){this._hlRoute.hide()}},_select:function(T){var jh=this._curIndex;var jf=this._opts.renderOptions;if(jf.panel){var jg=jf.panel.getElementsByTagName("table");var jm=jg[jg.length-1];var jj=jm.getElementsByTagName("tr");if(jh-1>=0&&jj[jh-1]){jj[jh-1].style.background=""}if(T-1>=0&&jj[T-1]){jj[T-1].style.background="#f0f0f0"}}var jq=jf.map;if(jq){var e=this._results.getPlan(0);var jo=e.getRoute(0);var js=this._getAllStepCount();var jr=this;jq.closeInfoWindow();if(T===0||T===js+1){var jn=T===0?this._results.getStart():this._results.getEnd();var i=e6.createTransInfoWnd({content:"<b>"+jn.title+"</b>",total:js,curIndex:T,nextTransCbk:function(jt){jr._select(jt)},hideStep:(jf.highlightMode===BMAP_HIGHLIGHT_STEP?false:true)});i.addEventListener("open",function(){jr._triggerCbk(az.CBK_INFO_HTML_SET,jn,e6.getInfoWindowDom(jq))});i.addEventListener("close",function(){if(jr._opts.renderOptions.panel){var ju=jf.panel.getElementsByTagName("table");var jv=ju[ju.length-1];if(jv){var jt=jv.getElementsByTagName("tr");if(jr._curIndex-1>=0&&jt[jr._curIndex-1]){jt[jr._curIndex-1].style.background=""}}}jr._curIndex=-1});var jp=T===0?0:1;var jr=this;if(jq.config.enableStreetEntrance&&false){PanoramaEntranceUtil.insearchPanoEntranceInInfoWnd(i,jq.getCurrentCity().code,{panoInstance:jq._pano,lngLat:jn.point,titleTip:jn.title,type:"busline",beforeDomId:"trans_nav"},function(){jr._overlays[jp].openInfoWindow(i)})}else{jr._overlays[jp].openInfoWindow(i)}if(this._hlRoute){this._hlRoute.hide()}}else{var jl=jf.highlightMode;if(jl===BMAP_HIGHLIGHT_STEP){var je=this._getCurStep(T-1);var i=e6.createTransInfoWnd({content:je.getDescription()?je.getDescription(false):je.instructions,total:js,curIndex:T,nextTransCbk:function(jt){jr._select(jt)}});i.addEventListener("open",function(){jr._triggerCbk(az.CBK_INFO_HTML_SET,je,e6.getInfoWindowDom(jq))});i.addEventListener("close",function(){if(jr._opts.renderOptions.panel){var ju=jf.panel.getElementsByTagName("table");var jv=ju[ju.length-1];if(jv){var jt=jv.getElementsByTagName("tr");if(jr._curIndex-1>=0&&jt[jr._curIndex-1]){jt[jr._curIndex-1].style.background=""}}}jr._curIndex=-1});var jk=je.getPosition?je.getPosition():je.pathPoints[je.pathPoints.length-1];var jr=this;if(jq.config.enableStreetEntrance&&false){PanoramaEntranceUtil.insearchPanoEntranceInInfoWnd(i,jq.getCurrentCity().code,{panoInstance:jq._pano,lngLat:jk,titleTip:je.getDescription?je.getDescription(false):je.instructions,type:"driving",beforeDomId:"trans_nav"},function(){jq.openInfoWindow(i,jk)})}else{jq.openInfoWindow(i,jk)}}else{if(jl===BMAP_HIGHLIGHT_ROUTE){if(T===1&&!this._opts._enableTraffic){var je=this._getCurStep(0);jq.setCenter(je.getPosition?je.getPosition():je.pathPoints[je.pathPoints.length-1]);if(jf.autoViewport){jq.setZoom(17)}if(this._hlRoute){this._hlRoute.hide()}}else{if(this._segPolylinePoints[T-1]){if(!this._hlRoute){this._hlRoute=e6.addRoute(jq,this._segPolylinePoints[T-1],jo.getRouteType()+2)}else{this._hlRoute.setPath(this._segPolylinePoints[T-1]);this._hlRoute.show()}if(jf.autoViewport){var ji=jq.getViewport(this._hlRoute.getBounds());if(ji.zoom>17){ji.zoom=17}jq.setViewport(ji)}}}}}}}this._curIndex=T},_toggle:function(){var i=this._opts.renderOptions;if(i.panel){var e=ev.getElementsByClassName(i.panel,"navtrans-res");if(e&&e.length>0){e=e[0];if(e&&e.style.display==="none"){e.style.display=""}else{e.style.display="none"}}var T=ev.getElementsByClassName(i.panel,"navtrans-view");if(T&&T.length>0){T=T[0];ev.toggleClass(T,"expand")}}},_clearOverlays:function(){var je=this._opts.renderOptions.map;if(!je){return}for(var T=0,e=this._overlays.length;T<e;T++){je.removeOverlay(this._overlays[T]);this._overlays[T]=null}this._overlays.length=0;je.removeOverlay(this._hlRoute);this._hlRoute=null;if(this._d){if(this._d.sliderMkr){je.removeOverlay(this._d.sliderMkr);this._d.sliderMkr=null}if(this._d.tipLbl){je.removeOverlay(this._d.tipLbl);this._d.tipLbl=null}for(var T=0,e=this._d.dragOverlays.length;T<e;T++){je.removeOverlay(this._d.dragOverlays[T]);this._d.dragOverlays[T]=null}this._d.dragOverlays.length=0;if(this._d.cbkPly){je.removeOverlay(this._d.cbkPly);this._d.cbkPly=null}for(var T=0,e=this._d.cxtMenu.length;T<e;T++){je.removeContextMenu(this._d.cxtMenu[T]);this._d.cxtMenu[T]=null}this._d.cxtMenu.length=0;this._d.mouseOnViaMkr=false}},_delVia:function(T){if(this._results){var i=this._results.getStart();var e=this._results.getEnd();this._d.viaPts.splice(T,1);this._stopDragging();this._dragSearch(i,e)}},_renderList:function(){if(this._opts.renderOptions.panel&&this._opts.renderOptions.panel.appendChild&&this._results&&this._results.getNumPlans()>0){var jf=this._results.getPlan(0);var jo=bL("div",{style:"font:12px "+w.fontFamily+";background:#fff"});var je=this._d.viaPtsInfo;var e=je.length;var jk=[];var ji="";switch(this.QUERY_TYPE){case aF:ji="驾车";break;case gP:ji="骑行";break;case ho:ji="步行";break}var ju=iO._genResultTitle(this._results.getEnd().title,ji,e>0);if(e>0){jk.push("<table style=\'width:100%;margin-left:4px;font:12px "+w.fontFamily+";border-collapse:collapse\' cellpadding=\'0\' cellspacing=\'0\' border=\'0\'>");for(var jr=0;jr<e;jr++){jk.push("<tr>");if(jr===0){if(e===1){jk.push(\'<td style="padding:2px 5px;line-height:20px">途经点</td>\')}else{jk.push(\'<td valign="top" rowspan="\'+e+\'" style="padding:2px 5px;line-height:18px">途经点</td>\')}}jk.push(\'<td style="padding:2px 5px;line-height:20px">\'+je[jr].title+"</td>");jk.push(\'<td style="padding:2px 10px;line-height:20px;cursor:pointer;color:#0000ff" onclick=\\\'BMapGL.I("\'+this.hashCode+\'")._delVia(\'+je[jr]["curNo"]+")\'>删除</td>");jk.push("</tr>")}jk.push("</table>")}var js=iO._genTitle(this._results.getStart().title,\'BMapGL.I("\'+this.hashCode+\'")._select(0)\',0);var jl=["<table class=\'navtrans-table\' style=\'width:100%;font:12px "+w.fontFamily+";border-collapse:collapse\' cellpadding=\'0\' cellspacing=\'0\' border=\'0\'>"];var jq=0;for(var jn=0,jj=jf.getNumRoutes();jn<jj;jn++){var jt=jf.getRoute(jn);for(var jr=0,jp=jt.getNumSteps();jr<jp;jr++){var jh="";if(this._curIndex===jq+1){jh=";background:#f0f0f0"}jl.push(\'<tr style="cursor:pointer\'+jh+\'" onclick=\\\'BMapGL.I("\'+this.hashCode+\'")._select(\'+(jq+1)+")\'>");jl.push("<td style=\'border-bottom:1px solid #E4E6E7;padding:10px;line-height:20px;\' >"+(this._getCurStep(jq).getDescription?this._getCurStep(jq).getDescription():this._getCurStep(jq)["instructions"])+"</td>");jl.push("</tr>");jq++}}jl.push("</table>");var T=iO._genTitle(this._results.getEnd().title,\'BMapGL.I("\'+this.hashCode+\'")._select(\'+(jq+1)+")",1);var jm="<div class=\'navtrans-view expand\' style=\'position:relative;color:#7777cc;background:#e5ecf9;height:53px;overflow:hidden;text-align:right\' onclick=\'BMapGL.I(\\""+this.hashCode+"\\")._toggle()\'><span class=\'suggest-plan\'>推荐</span><div class=\'suggest-plan-des\'>"+jf.getDistance().replace(/(\\d+(?:.\\d+)?)/,"$1 ")+"&nbsp;&nbsp;|&nbsp;&nbsp;"+jf.getDuration().replace(/(\\d+)/,"$1 ")+"</div>";if(this._results.moreResultsUrl){jm+="<a style=\'color:#7777cc;position:absolute;top:5px;right:20px;\' href=\'"+this._results.moreResultsUrl+"\' target=\'_blank\'>到百度地图查看&#187;</a>"}jm+="&nbsp;<span class=\'navtrans-arrow\'></span></div>";var jg="<div class=\'navtrans-res\'>"+jk.join("")+js+jl.join("")+T+"</div>";jo.innerHTML=ju+jm+jg;this._opts.renderOptions.panel.appendChild(jo);this._triggerCbk(az.CBK_RESULTS_HTML_SET,jo)}},_getRoadName:function(i,e){if(e===""||!e){if(i===9||i===12||i===1||i===16){e=ck.ROAD_TYPE[i]}}return e},_getPoiInfo:function(jg){var e="";var jf=jg.poi;if(jf){var je=this._getPsType(jf.ps)||"";var i=this._getPwType(jf.pw)||"";var T=jf.pd<((jg.t===13||jg.t===4)?1000:50)?"":"约"+hU(jf.pd)+"后";e=i+je+"<b>"+jf.pn+"</b>"+T+(je===""?"":"，")}return e},_getTicInfo:function(i){var e=i.iw;return !i.ic?"":((this._getIwGo(e)||"")+"<b>"+i.ic+"</b>"+(this._getIwTo(e)||""))},_getRoadAct:function(T,i){var e="沿";if(T===0||(!i&&T!==1&&T!==16&&T!==9&&T!==12)){e=""}return e},_getRetAct:function(T,i){var e="进入";if(!i&&(T===9||T===12)){e="上"}else{if(T===0||(!i&&T!==1&&T!==16)){e=""}}return e},_getTaxiFare:function(){if(this._json&&this._json.content&&this._json.content["taxi"]){var je=this._json.content["taxi"];var e={distance:je.dis,remark:je.remark};if(je.detail[0]){var T=je.detail[0];e.day={initialFare:parseFloat(T.startPrice),unitFare:parseFloat(T.kmPrice),totalFare:parseFloat(T.totalPrice)}}if(je.detail[1]){var i=je.detail[1];e.night={initialFare:parseFloat(i.startPrice),unitFare:parseFloat(i.kmPrice),totalFare:parseFloat(i.totalPrice)}}return e}return null}});b8.TURN_TYPE=["","直行","右前方转弯","右转","右后方转弯","调头","左后方转弯","左转","左前方转弯","靠左","直行","靠右","正北方向","东北方向","正东方向","东南方向","正南方向","西南方向","正西方向","西北方向"];b8.RET_TYPE=["","从起点出发","到达目的地","途经点","行驶"];b8.TURN_ICON_CLASS=["s-1","s-1","s-2","s-3","s-4","s-5","s-6","s-7","s-8","s-9","s-1","s-10","","","","","","","",""];b8.IWGO=["在","从","从"];b8.IWTO=["","","离开"];b8.PWTYPE=["过","在"];b8.PSTYPE=["左侧的","右侧的",""];b8.DWTYPE=["","朝"];ev.extend(b8.prototype,{_createResults:function(e){return new hc(e)},_getTurnType:function(e){return b8.TURN_TYPE[e]},_getTurnIcon:function(T){var i="navtrans-navlist-icon "+(b8.TURN_ICON_CLASS[T]?b8.TURN_ICON_CLASS[T]:"");var e=\'<span class="\'+i+\'"></span>\';return e},_getRetType:function(e){return b8.RET_TYPE[e]},_getIwGo:function(e){return b8.IWGO[e]},_getIwTo:function(e){return b8.IWTO[e]},_getPwType:function(e){return b8.PWTYPE[e]},_getPsType:function(e){return b8.PSTYPE[e]},_getDwType:function(e){return b8.DWTYPE[e]}});eV.TURN_TYPE=["","直走","向右前方转","右转","向右后方转","向后转","向左后方转","左转","向左前方转","左转穿过马路并继续向前","右转穿过马路并继续向前","左转穿过马路并往回走","右转穿过马路并往回走","正北方向","东北方向","正东方向","东南方向","正南方向","西南方向","正西方向","西北方向","","","",""];eV.TURN_ICON_CLASS=["s-1","s-1","s-2","s-3","s-4","s-5","s-6","s-7","s-8","s-7","s-3","s-7","s-3","","","","","","","","","","","",""];eV.RET_TYPE=["","从起点出发","到达目的地","途经点","走"];eV.IWGO=["在","从","从"];eV.IWTO=["","","离开"];eV.PWTYPE=["过","在"];eV.PSTYPE=["左侧的","右侧的",""];eV.DWTYPE=["","朝"];ev.extend(eV.prototype,{_createResults:function(e){delete e.url;return new o(e)},_getTurnType:function(e){return eV.TURN_TYPE[e]},_getTurnIcon:function(T){var i="navtrans-navlist-icon "+(eV.TURN_ICON_CLASS[T]?eV.TURN_ICON_CLASS[T]:"");var e=\'<span class="\'+i+\'"></span>\';return e},_getRetType:function(e){return eV.RET_TYPE[e]},_getIwGo:function(e){return eV.IWGO[e]},_getIwTo:function(e){return eV.IWTO[e]},_getPwType:function(e){return eV.PWTYPE[e]},_getPsType:function(e){return eV.PSTYPE[e]},_getDwType:function(e){return eV.DWTYPE[e]}});ev.extend(cJ.prototype,{_createResults:function(e){delete e.url;return new eP(e)}});var dA=new h8(9,0);var h1=new h8(300,300);ev.extend(gz.prototype,{render:function(jj){window.RouteAddrInst=this;var jg={};var ju=this.json;this.endIndex=1;var je=this.endIndex;var jo=[];var js=[];var jx=["sel_n","sel_n1","sel_y","sel_x","sel_x1"];var jv=[-1,-1];var jp=[];var js=[];var jl=ju.content["result"];this.tpCity=[jl.originInfo["area_id"],jl.destinationInfo["area_id"]];tempCode=jl.originInfo["area_id"];for(var jq=0;jq<je+1;jq++){var jk=null;jo.push([]);jp.push("");js.push("");if(jq==0){if(jl.originInfo){this.tpCity[0]=jl.originInfo["area_id"];tempCode=this.tpCity[0]}}else{if(jl.destinationInfo){this.tpCity[jq]=jl.destinationInfo["area_id"];tempCode=this.tpCity[jq]}}jk=this.getCurPoint30(jq);if(jk.length>0){js[jq]=\'<a href="javascript:void(0)" ></a>\';jo[jq].push(\'<div id="RADiv_ResItem\'+jq+\'" class="sel_body_body_div sel_body_resitem">\');var ji=[0,9];if(jk.length<10){ji[1]=jk.length-1}jo[jq].push(this.makeListTable(jq,ji));if(jk.length>10){jo[jq].push(\'<div id="RADiv_PAGE\'+jq+\'" style="height:20px;" class="sel_body_body_page"></div>\');this.totalPage[jq]=Math.ceil(jk.length/10);this.curPageIndex[jq]=1}jo[jq].push("</div>");if(jk.length===1){jv[jq]=2;this.qInfo[jq]["n"]=jk[0]["name"];this.qInfo[jq]["c"]=tempCode;this.qInfo[jq]["u"]=jk[0]["uid"];var e=new cf(jk[0]["location"]["lng"],jk[0]["location"]["lat"]);var jy=e;this.qInfo[jq]["point"]=e;this.qInfo[jq]["x"]=jy.lng;this.qInfo[jq]["y"]=jy.lat;this.qInfo[jq]["t"]=BMAP_POI_TYPE_NORMAL;var jn=this.addPointMarker(this._opts.renderOptions.map,jy,jk[0]["name"],jq);this.markerDest=jn;this.locPois.push(jn.point);jp[jq]=jk[0]["name"]}else{jv[jq]=0}}}var jf;var T;var jm=false;var jt=false;for(var jr=0,jh;jr<jv.length;jr++){jh=jv[jr];if(jf){if(jh==0||jh==3){jv[jr]=jh+1}}else{if(jh==0&&!T){this.curPointIndex=jr;T=jr+1;continue}if(T&&jh==0){jv[jr]=1}}}jg.startPointClass=jx[jv[0]];this.startName=jl.originInfo["wd"];if(jp[0]==""){jg.startPoint=this.startName}else{jg.startPoint=jp[0]}jg.startBody=jo[0].join("");jg.endPointClass=jx[jv[je]];this.endName=jl.destinationInfo["wd"];if(jp[je]==""){jg.endPoint=this.endName}else{jg.endPoint=jp[je]}jg.endBody=jo[je].join("");jg.startButton=js[0];jg.endIndex=je;jg.endButton=js[je];this.tpName=[];var jw=[""];jg.tpList=jw.join("");return this.template(jg)},bindEvent:function(){var i,e;if(ev.G("RouteAddress_DIV0")){i=ev.G("RouteAddress_DIV0").getElementsByTagName("tr");this.routDivTrBindFun(i)}if(ev.G("RouteAddress_DIV1")){e=ev.G("RouteAddress_DIV1").getElementsByTagName("tr");this.routDivTrBindFun(e)}var jf=this;if(this.infoWindow){this.infoWindow.addEventListener("open",function(){var jg=ev.G("selInfoWndBtn");ev.on(jg,"click",function(){var jh=jg.getAttribute("data-uid").split("_");jf.itmSelect(jh[0],jh[1])});ev.on(jg,"mouseover",function(){jf._selBtnOver(jg)});ev.on(jg,"mousedown",function(){jf._selBtnDown(jg)});ev.on(jg,"mouseout",function(){jf._selBtnOut(jg)})})}var je,T;if(ev.G("RouteAddress_DIV0")){je=ev.G("RouteAddress_DIV0").firstChild.firstChild;ev.on(je,"click",function(jh){var jg=je.getAttribute("data-uid");jf.showLst(jg)})}if(ev.G("RouteAddress_DIV1")){T=ev.G("RouteAddress_DIV1").firstChild.firstChild;ev.on(T,"click",function(jh){var jg=T.getAttribute("data-uid");jf.showLst(jg)})}},routDivTrBindFun:function(i){var e=this;this.each(i,function(T,je){ev.on(je,"mouseover",function(jh){var ji=je.getAttribute("data-uid").split("_");var jg=parseInt(ji[0],10);n2=parseInt(ji[1],10);iv=parseInt(ji[2],10);e._lstMouseOver(this,0,ji[0],iv-n2,jh)});ev.on(je,"mouseout",function(jh){var ji=je.getAttribute("data-uid").split("_");var jg=parseInt(ji[0],10);n2=parseInt(ji[1],10);iv=parseInt(ji[2],10);e._lstMouseOut(this,0,ji[0],iv-n2,jh)});ev.on(je,"click",function(jh){var ji=je.getAttribute("data-uid").split("_");var jg=parseInt(ji[0],10);n2=parseInt(ji[1],10);iv=parseInt(ji[2],10);e.select(jg,iv,jh)});var jf=je.childNodes[2].getElementsByTagName("div")[0];ev.on(jf,"click",function(jg){var jj=jf.getAttribute("data-uid").split("_"),ji=jj[0],jh=jj[1];e.itmSelect(ji,jh)});ev.on(jf,"onmouseover",function(jg){e._selBtnOver(jf)});ev.on(jf,"onmouseout",function(jg){e._selBtnOut(jf)});ev.on(jf,"onmousedown",function(jg){e._selBtnDown(jf)})})},formatJson30:function(i,e){},parseJson:function(jg,e){if(!jg.content){jg.content={start:[],end:[]}}jg.content["tpList"]=[];if(jg.result.type==19){this.parseQuery(jg,e);var jh=jg.content,je=[],T=jh.length;jg.content={start:[],end:[]};if(T>2){for(var jf=1;jf<(T-1);jf++){je.push(jh[jf])}}jg.content["end"]=jh[T-1];jg.content["tpList"]=je;jg.content["start"]=jh[0]}return jg},parseQuery:function(jp,T){var jn={},jl=this,e,je,jj=0,jh=0,ji=[],jk,jq=jp.result,jg=[];jn.city_list=[];jn.count=[];jn.current_null=[];jn.e_query=[];jn.e_wd=[];jn.end_city=[];jn.wd2=[];jn.prio_flag=[];jn.sug_index=[];jn.total=[];jn.s_wd="";jn.s_query="";this.canShowList=[];if(!jq.e_wd){jq.e_wd=[];jq.e_query=[]}e=this.parseOnePosition(T.start);jk=e.type;jn.s_wd=jk==1?e.keyword:jq.s_wd;jn.s_query=jk==1?e.keyword:jq.s_query;if(jk==1){jl.qInfo[jj].n=jn.s_wd;jl.qInfo[jj].x=e.point.split(",")[0];jl.qInfo[jj].y=e.point.split(",")[1]}this.canShowList.push(jk==2);jn.total.push(jk==1?1:jq.total[jh]);jn.count.push(jk==1?1:jq.count[jh]);jn.current_null.push(jk==1?0:jq.current_null[jh]);jn.prio_flag.push(jk==1?1:jq.prio_flag[jh]);jn.sug_index.push(jk==1?"":jq.sug_index[jh]);ji.push(jk==1?[{name:e.keyword,geo:"1|"+e.point+";"+e.point+"|"+e.point+";"}]:jp.content[jh]);jn.city_list.push(jk==1?0:jq.city_list[jh]);jn.wd2.push(jk==1?"":jq.wd2[jh]);if(jk==2){jh++}jj++;jg=decodeURIComponent(T.end).split("to:");for(var jf=0,jo;(jo=jg[jf]);jf++){jo=this.parseOnePosition(jo);jk=jo.type;if(jk==2){if(jo.uid&&jo.point){jk=1}}this.canShowList.push(jk==2);var jm=jk==2?jo.keyword:jh==0?jq.s_wd:jq.e_wd[jh-1];jn.e_wd.push(jm);jn.e_query.push(jm);jn.end_city.push(jk==1?jp.current_city:jh==0?jq.start_city:jq.end_city[jh-1]);if(jk==1){jl.qInfo[jj].n=jn.s_wd;jl.qInfo[jj].x=jo.point.split(",")[0];jl.qInfo[jj].y=jo.point.split(",")[1]}if(jo.if_wp){this.insertTP(jj-1,{query:jn.e_wd[jj-1],addr:jn.wd2[jj],point:jk==1?by.getPoiPoint(jo.point):null,uid:jo.uid});this.tpListInMap.push({query:jn.e_wd[jj-1],addr:jn.wd2[jj],point:jk==1?by.getPoiPoint(jo.point):null,uid:jo.uid})}jn.total.push(jk==1?1:jq.total[jh]);jn.count.push(jk==1?1:jq.count[jh]);jn.current_null.push(jk==1?0:jq.current_null[jh]);jn.prio_flag.push(jk==1?1:jq.prio_flag[jh]);jn.sug_index.push(jk==1?"":jq.sug_index[jh]);ji.push(jk==1?[{name:jo.keyword,geo:"1|"+jo.point+";"+jo.point+"|"+jo.point+";"}]:jp.content[jh]);jn.city_list.push(jk==1?0:jq.city_list[jh]);jn.wd2.push(jk==1?"":jq.wd2[jh]);if(jk==2){jh++}jj++}ev.extend(jp.result,jn);jp.content=ji},insertTP:function(e,T){var i=ev.extend({},T);if(this.tpList.length>e){this.tpList[e]=T}else{if(this.tpList.length==e){this.tpList.push(T)}else{return}}this.tpList[e]=i},parseOnePosition:function(i){var i=decodeURIComponent(i),e=i.split("$$");return{type:e[0],uid:e[1],point:e[2],keyword:e[3],if_sug:e[4],keyword2:e[5],fe_xy:e[6],if_wp:e[7]}},getCurPoint30:function(e){var i=[];switch(e){case 0:case"0":i=this.json.content["result"]["origin"]["content"];break;case 1:case"1":i=this.json.content["result"]["destination"]["content"];break}return i},getCurPoint:function(e){return e==0?this.json.content["start"]:(e==this.endIndex?this.json.content["end"]:this.json.content["tpList"][e-1])},makeListTable:function(jg,jf,je){var ji=this;this.curSelectedIndex=-1;var jj=je?je:this.getCurPoint30(jg);var jh=[];jh.push(\'<div id="RA_ResItem_\'+jg+\'"><table border="0" cellspacing="0" cellpadding="0" style="width:100%">\');for(var T=jf[0];T<=jf[1];T++){jh.push(\'<tr  onmouseover="RouteAddrInst._lstMouseOver(this, 0,\'+jg+", "+(T-jf[0])+\', event)" onmouseout="RouteAddrInst._lstMouseOut(this, 0,\'+jg+", "+(T-jf[0])+\', event)" onclick="RouteAddrInst.select(\'+jg+","+T+\', event)"  filter = "item" data-uid="\'+jg+"_"+jf[0]+"_"+T+\'"  ><th><div title="在图上显示该点" class="icon iconbg" id="no_\'+jg+"_"+(T-jf[0]+1)+\'"></div></th>\');var e=(jg==0)?"选为起点":(jg==this.endIndex)?"选为终点":"选为途经点";jh.push(\'<td style="word-break:break-all;padding-right:24px">\');jh.push(\'<a href="javascript:void(0)">\'+jj[T]["name"]+"</a>");if(jj[T]["address"]&&jj[T]["address"]!=""){jh.push("<div>");jh.push(\'<span style="color:#999">地址: \'+jj[T]["address"]+"</span>");jh.push("</div>")}jh.push("</td>");jh.push(\'<td style="vertical-align:middle;width:106px"><div tid="selBtn_\'+jg+"_"+T+\'" class="selBtn"  onclick="RouteAddrInst.itmSelect(\'+jg+","+T+\');return false;" onmouseover="RouteAddrInst._selBtnOver(this)" onmouseout="RouteAddrInst._selBtnOut(this)" onmousedown="RouteAddrInst._selBtnDown(this)" data-uid = "\'+jg+"_"+T+\'"  >\'+e+"</div>");jh.push(\'<a data-uid="\'+jj[T]["uid"]+\'" href="javascript:void(0);" class="list_street_view_poi" style="visibility:hidden"><img src="//map.baidu.com/wolfman/static/common/images/transparent.gif" ></a>\');jh.push("</td>");jh.push("</tr>")}jh.push("</table></div>");return jh.join("")},addPointMarker:function(jf,je,i,e,T){var jh;if(e==0){jh=e6.addDestPoi(jf,je,i,c4)}else{if(e==this.endIndex){jh=e6.addDestPoi(jf,je,i,ha)}else{var jg=this.tpListInMap[e-1];jg.point=je;T&&(jg.uid=T);jh=e6.addWayPointMkr(jf,je,e-1)}}this.destList.push(jh);return jh},template:function(i){var T=[];T.push(\'<div class="RouteAddressOuterBkg">\');T.push(\'<div class="RouteAddressTip"><span>请选择准确的起点、途经点或终点</span></div>\');T.push(\'<div class="RouteAddressInnerBkg">\');T.push(\'<div id="pos5" style="display:none"></div>\');T.push(\'<div id="RouteAddress_DIV0" class="\'+i.startPointClass+\'"> \');T.push(\'<div class="sel_body">\');T.push(\'<div class="sel_body_top" data-uid="0" onclick="RouteAddrInst.showLst(0)" >\');T.push(\'<div class="sel_body_title">\');T.push(\'<div class="sel_body_sign"></div>\');T.push(\'<div class="sel_body_name">起点：<b id="B_PointName0">\'+i.startPoint+"</b></div>");T.push("</div>");T.push(\'<div id="RD_TOP_BUT0" class="sel_body_button">\'+i.startButton+"</div>");T.push("</div>");T.push(\'<div class="sel_body_body" id="RADIV_BODY0">\'+i.startBody+"</div>");T.push("</div>");T.push("</div>");T.push(i.tpList);T.push(\'<div id="RouteAddress_DIV\'+i.endIndex+\'" class="\'+i.endPointClass+\'">\');T.push(\'<div class="sel_body">\');T.push(\'<div class="sel_body_top" data-uid=\'+i.endIndex+\' onclick="RouteAddrInst.showLst(\'+this.endIndex+\')" >\');T.push(\'<div class="sel_body_title">\');T.push(\'<div class="sel_body_sign"></div>\');T.push(\'<div class="sel_body_name">终点：<b id="B_PointName\'+i.endIndex+\'">\'+i.endPoint+"</b></div>");T.push("</div>");T.push(\'<div id="RD_TOP_BUT\'+i.endIndex+\'" class="sel_body_button">\'+i.endButton+"</div>");T.push("</div>");T.push(\'<div class="sel_body_body" id="RADIV_BODY\'+i.endIndex+\'">\'+i.endBody+"</div>");T.push("</div>");T.push("</div>");T.push(\'<div id="pos6" style="display:none"></div>\');T.push("</div>");T.push("</div>");var e=T.join("");return e},showLst:function(jm){this.curPointIndex=jm;var jk=this,jl=[];var je=jl.length+1;var jh=this.getCurPoint30(jm);var ji=jk.curPageIndex;var jj=ev.G("RouteAddress_DIV"+jm)["className"];if(jj=="sel_n"||jj=="sel_x"||(this.canShowList&&!this.canShowList[jm])){return}if(jj=="sel_n1"||jj=="sel_y"||jj=="sel_x1"){for(var T=0;T<=je;T++){var e=ev.G("RouteAddress_DIV"+T);ev.G("B_PointName"+T).innerHTML=this.getCurPoiName(T);if(e.className=="sel_x"){e.className="sel_x1"}else{if(e.className=="sel_n"){e.className="sel_n1"}}}jk.clearMarkers();if(jk.markerDest){for(var T=0;T<jk.destList.length;T++){jk.map.removeOverlay(jk.destList[T])}jk.destList=[];jk.markerDest=null}if(jj=="sel_y"){jk.qInfo[jm]={n:"",c:0,u:0,x:0,y:0,t:-1};jk.resType[jm]=0}var jg=0;if(jm===0){jg=jk.json.content["result"]["origin"].length}else{if(jm===1){jg=jk.json.content["result"]["destination"].length}}if(jg<=0){ev.G("RouteAddress_DIV"+jm)["className"]="sel_x"}else{ev.G("RouteAddress_DIV"+jm)["className"]="sel_n";var jf=(ji[jm]-1)*10+9;if(jh.length<(jf+1)){jf=jh.length-1}jk.addMarkers(jm,[(ji[jm]-1)*10,jf])}}this.curSelectedIndex=-1},_selectIt:function(jk,jg){var jj=this;var jm;if(ev.G("RA_ResItem_"+jk)){jm=ev.G("RA_ResItem_"+jk).childNodes[0]}if(jm){var ji=jm.rows[jg];if(ji){ji.style.backgroundColor="#F4F4F4";var T=ji.getElementsByTagName("td")[1];var je=T.childNodes[0];je.style.visibility="visible";var i=ji.getElementsByTagName("th")[0];var jl=i.childNodes[0];jl.style.backgroundPosition=-jg*18+"px -166px"}}if(jj.markersList.length>jg){var jh=w.staticHost+"/wolfman/static/common/images/";jh+="markers_new2x_2960fb4.png";var e=new h8(18*jg,166);var jf=new iy(jh,new h8(18,27),{offset:new h8(9,27),imageOffset:e,infoWindowOffset:dA,imageSize:h1,});jj.markersList[jg].setIcon(jf);jj._setTop(jj.markersList[jg],true,true)}},_lstMouseOver:function(je,T,jh,i,jg){var jf=this._opts.renderOptions.map;if(this.curSelectedIndex!=i){jf.closeInfoWindow();this._selectIt(jh,i)}},_lstMouseOut:function(je,T,jg,i,jf){if(this.curSelectedIndex!=i){this._unSelectIt(jg,i)}},_unSelectIt:function(jk,jg){var jj=this;var jm=null;if(ev.G("RA_ResItem_"+jk)){jm=ev.G("RA_ResItem_"+jk).childNodes[0]}if(jm){var ji=jm.rows[jg];ji.style.backgroundColor="#ffffff";var T=ji.getElementsByTagName("td")[1];var je=T.childNodes[0];je.style.visibility="";var i=ji.getElementsByTagName("th")[0];var jl=i.childNodes[0];jl.style.backgroundPosition=-jg*18+"px -273px"}if(jj.markersList.length>jg){var jh=w.staticHost+"/wolfman/static/common/images/";jh+="markers_new2x_2960fb4.png";var e=new h8(18*jg,273);var jf=new iy(jh,new h8(18,27),{offset:new h8(9,27),imageOffset:e,infoWindowOffset:dA,imageSize:h1,});jj.markersList[jg].setIcon(jf);jj._setTop(jj.markersList[jg],false)}},_setTop:function(T,i,e){if(!T||!T.setTop){return}if(i&&!T._isTop&&T.iconDom&&T.iconDom.style){T._isTop=true;if(e){T.setTop(true,1000100)}else{T.setTop(true)}return}if(!i&&T.iconDom&&T.iconDom.style){delete T._isTop;T.setTop(false)}},select:function(T,i,jf){if(arguments.length>2){jf=jf||window.e;var e=jf.srcElement||jf.target;if(e.className=="selBtn"){return}}var jh=this.json.content||[];var je=this;var jg=je.getCurPoint30(T);this.map.closeInfoWindow();if(!jg){return}if((je.resCity[0]!=je.resCity[1])&&je.markerDest){if(this.map){this.map.setViewport(je.pointsList)}}this._showInfoWindow(jg,T,i);if(this.curSelectedIndex!=-1){this._unSelectIt(T,this.curSelectedIndex)}this.curSelectedIndex=i%10;this._selectIt(T,this.curSelectedIndex)},clearMarkers:function(){var i=this;(function T(){if(i.markersList.length===0){return}i.map.removeOverlay(i.markersList.shift());T()})();(function e(){if(i.pointsList.length===0){return}i.pointsList.shift();e()})()},itmSelect:function(jk,jj){var jo=this;var je=this.map;var jn=jo.json.content||[];var jm=this.getCurPoint30(jk);jo.qInfo[jk]["n"]=jm[jj]["name"];jo.qInfo[jk]["c"]=this.resCity[jk];jo.qInfo[jk]["u"]=jm[jj]["uid"];var jq=new cf(jm[jj]["location"]["lng"],jm[jj]["location"]["lat"]);var jg=jq;jo.qInfo[jk]["point"]=jq;jo.qInfo[jk]["x"]=jg.lng;jo.qInfo[jk]["y"]=jg.lat;jo.qInfo[jk]["t"]=BMAP_POI_TYPE_NORMAL;if(ev.G("B_PointName"+jk)){ev.G("B_PointName"+jk).innerHTML=jm[jj]["name"]}jo.markerDest=this.addPointMarker(je,jg,jm[jj]["name"],jk);if(jk!=0&&jk!=this.endIndex){var jp=this.tpListInMap[jk-1];jp.query=jm[jj].name}jo.clearMarkers();if(this.isAllPointSure()){if(jo.markerDest){for(var jf=0;jf<jo.destList.length;jf++){jo.map.removeOverlay(jo.destList[jf])}jo.destList=[];je.removeOverlay(jo.markerDest);jo.markerDest=null}jo.submit()}else{if(ev.G("RouteAddress_DIV"+jk)){ev.G("RouteAddress_DIV"+jk)["className"]="sel_y"}var T=0;for(var jf=1;jf<=this.endIndex;jf++){var ji=(jk+jf)%(this.endIndex+1);if(ev.G("RouteAddress_DIV"+ji)&&ev.G("RouteAddress_DIV"+ji)["className"]!="sel_y"){T=ji;break}else{T=ji;break}}if(jo.resType[T]==0){if(ev.G("RouteAddress_DIV"+(T))){ev.G("RouteAddress_DIV"+(T))["className"]="sel_n"}var jl=jo.curPageIndex[T];var jh=(jl-1)*10+9;var e=this.getCurPoint30(T);if(e.length<(jh+1)){jh=e.length-1}jo.addMarkers(T,[(jl-1)*10,jh]);jo.select(T,0)}else{if(jo.resType[T]==2){if(ev.G("RouteAddress_DIV"+(T))){ev.G("RouteAddress_DIV"+(T))["className"]="sel_n"}}else{if(ev.G("RouteAddress_DIV"+(T))){ev.G("RouteAddress_DIV"+(T))["className"]="sel_x"}}}this.curPointIndex=T}},submit:function(){var je=this;var jf=this.map;var jg=je.qInfo[0]["c"];var i=je.qInfo[je.endIndex]["c"];if(jg==i){var jh=jg}var e={};var T=new fa("onpoiselected");e.start_name=je.qInfo[0]["point"]["lat"]+","+je.qInfo[0]["point"]["lng"];e.end_name=je.qInfo[1]["point"]["lat"]+","+je.qInfo[1]["point"]["lng"];e.region=je.qInfo[0]["c"]||je.qInfo[1]["c"];T.paramInfo=e;jf.dispatchEvent(T)},getTPointQueryParam:function(jj,e){var ji=2,jf="",jk="",jg="",T="0",i="",je="",jl="",jh="1";if(jj.point||jj.rPoint){ji=1;jk=jj.point?(jj.point.lng+","+jj.point.lat):(jj.rPoint.lng+","+jj.rPoint.lat);if(jj.uid){ji=2;jf=jj.uid}}if(jj.query){jg=jj.query}if(jj.addr){T="1";i=jj.addr}if(!isNaN(e)){ji=e}return ji+"$$"+jf+"$$"+jk+"$$"+jg+"$$"+T+"$$"+i+"$$"+je+"$$"+jh+"$$+to:"},isAllPointSure:function(){for(var e=0;e<=this.endIndex;e++){if(this.qInfo[e]["n"]==""&&!this.qInfo[e]["x"]&&!this.qInfo[e]["y"]||this.qInfo[e]["n"]==undefined){return false}}return true},_selBtnOver:function(e){e.style.backgroundPosition="-100px -81px"},_selBtnOut:function(e){e.style.backgroundPosition="-21px -81px"},_selBtnDown:function(e){e.style.backgroundPosition="-220px -81px";e.style.fontWeight="bold"},initialize:function(){var ji=this;var je=this.endIndex;var jl=this.json;ji.setParsValue();for(var jg=0;jg<=je;jg++){if(ev.G("RADiv_PAGE"+jg)){pg0=new eg("RADiv_PAGE"+jg,function(jo){var jn=ji.curPointIndex;var jm=[(jo-1)*10,jo*10-1];if(ji.resCount[jn]<(jm[1]+1)){jm[1]=ji.resCount[jn]-1}ev.remove=function(i){i=ev.G(i);var jp=i.parentNode;jp&&jp.removeChild(i)};if(ev.G("RA_ResItem_"+jn)){ev.remove(ev.G("RA_ResItem_"+jn));ev.insertHTML(ev.G("RADiv_ResItem"+jn),"AFTERBEGIN",ji.makeListTable(jn,jm))}ji.addMarkers(jn,jm,true);ev.G("RADiv_ResItem"+jn).scrollTop=0;ji.curPageIndex[jn]=jo},{pagecap:5,pageCount:ji.totalPage[jg],page:ji.curPageIndex[T]})}}var jf=[0,9];var jk=this.curPointIndex,jj=ev.G("RouteAddress_DIV"+jk),e=this.getCurPoint30(jk);if(jj.className=="sel_n"){if(e&&e.length>0){if(e.length<(jf[1]+1)){jf[1]=e.length-1}ji.addMarkers(jk,jf);ji.select(jk,0)}}else{if(this.markerDest&&jj.className=="sel_x"){this.map.setViewport(this.locPois)}}for(var T=0;T<=je;T++){if(ev.G("RouteAddress_DIV"+T)["className"]=="sel_y"){var jh=this.getCurPoint30(T);if(jh.length>0&&jh[0].ifFromIW&&jh[0].ifFromIW==1){ev.rc(ev.G("RD_TOP_BUT"+T),"sel_body_button");ev.G("RD_TOP_BUT"+T).innerHTML=""}}}},withoutPanelInitial:function(){var ji=this;var je=this.endIndex;var jl=this.json;ji.setParsValue();for(var jh=0;jh<=je;jh++){var T=ji.curPointIndex;var jg=[0,9];if(ji.resCount[T]<(jg[1]+1)){jg[1]=ji.resCount[T]-1}ji.addMarkers(T,jg,true)}var jf=[0,9];var jk=this.curPointIndex,jj=ev.G("RouteAddress_DIV"+jk),e=this.getCurPoint30(jk);if(jk==1){if(e&&e.length>0){if(e.length<(jf[1]+1)){jf[1]=e.length-1}ji.addMarkers(jk,jf)}}else{if(this.markerDest&&jk==0){if(this.map){this.map.setViewport(this.pointsList)}}}ji.select(jk,0)},setStatusByRes:function(T){var je=this.map;if(T.current_city){if(!(T.result.result_show&1)&&(T.result.type==29||T.result.type==13)){var jf=T.current_city;var i=["country","province","city","area"],jg=jf.type!=null?modelConfig.level[i[jf.type]]:undefined,e=jf.geo!=null?e=by.parseGeo(jf.geo,true).point:undefined;if(!je.enableLoadTiles){je.enableLoadTiles=true;je.centerAndZoom(e||je.getCenter(),jg||je.getZoom())}else{if(jg){je.zoomTo(jg)}if(e){je.setCenter(e)}}}}},setParsValue:function(){this.resCity=this.tpCity;var e=this.json.content["result"];if(e.origin["content"].length>0){if(e.origin["content"].length===1){this.resType[0]=1}else{this.resType[0]=0}this.resCount[0]=e.origin["content"].length}else{this.resType[0]=3}if(e.destination["content"].length>0){if(e.destination["content"].length===1){this.resType[1]=1}else{this.resType[1]=0}this.resCount[1]=e.destination["content"].length}else{this.resType[1]=3}return},addMarkers:function(jn,jm,jf){var jp=this.json.content||[];var jq=this;var jo=this.getCurPoint30(jn);var je=jq.map;jq.clearMarkers();if(!jo){return}for(var jk=jm[0];jk<=jm[1];jk++){var jr=new cf(jo[jk]["location"]["lng"],jo[jk]["location"]["lat"]);jq.markersList.push(e6.addSearchPoi_R(jr,jk-jm[0],jo[jk]["name"],{type:"RouteAddrMarker"},je));jq.pointsList.push(jr)}var ji=jq.pointsList;if(jq.markerDest){if(!((jq.resCity[0]!=jq.resCity[1]))){ji.push(jq.markerDest.getPosition())}}var e=this.map.getMapType();if(false){var jg=dR[BMAP_PERSPECTIVE_MAP].citys;var jj=jg[je.currentCity][1];var jl=getPointsBounds(ji);var T=je.getViewport(jl)["zoom"];if(jj.intersects(jl)){if(T<=15){T=15}je.centerAndZoom(ji[0],T)}else{if(je){je.setViewport(ji)}}}else{if(je){je.setViewport(ji)}}if(jq.pointsList.length==11){jq.pointsList.pop()}var jh=this.markersList;for(var jk=jm[0];jk<=jm[1];jk++){(function(){var i=jk;if(jh[jk-jm[0]]){jh[jk-jm[0]].addEventListener("click",function(){jq.select(jn,i)});jh[jk-jm[0]].addEventListener("mouseover",function(){var js=i%10;if(jq.curSelectedIndex!=js){jq._selectIt(jn,js)}});jh[jk-jm[0]].addEventListener("mouseout",function(){var js=i%10;if(jq.curSelectedIndex!=js){jq._unSelectIt(jn,js)}})}})()}},_showInfoWindow:function(ji,jg,jf){var jj=this;var jh=ji[jf];var i="<span class=\'iw_poi_title\' title=\'"+jh.name+"\'>"+jh.name+"</span>";var T=[];var jk="";if(jh.address&&jh.address!=""){jk="地址: "+jh.address}T.push("<div style=\'padding:11px 11px 6px 11px;line-height:20px;word-break:break-all\'>"+jk+"</div>");T.push("<div style=\'line-height:180%;margin-bottom:10px;\'>");var je="选为途经点";if(jg==0){je="选为起点"}if(jg==this.endIndex){je="选为终点"}T.push("<div style=\'text-align:center;\'><div id=\'selInfoWndBtn\' class=\'selInfoWndBtn\'  data-uid = \'"+jg+"_"+jf+"\'  />"+je+"</div>");T.push("</div>");if(!this.infoWindow){this.infoWindow=new dC(T.join(""),{title:i,height:0,width:280,margin:[0,0,0,0]});this.infoWindow.addEventListener("open",function(){var jl=ev.G("selInfoWndBtn");ev.on(jl,"click",function(){var jm=jl.getAttribute("data-uid").split("_");jj.itmSelect(jm[0],jm[1])});ev.on(jl,"mouseover",function(){jj._selBtnOver(jl)});ev.on(jl,"mousedown",function(){jj._selBtnDown(jl)});ev.on(jl,"mouseout",function(){jj._selBtnOut(jl)})});this.infoWindow.addEventListener("close",function(){jj._unSelectIt(jg,e)})}else{this.infoWindow.setTitle(i);this.infoWindow.setContent(T.join(""))}var e=jf%10;if(this.markersList&&this.markersList[e]){this.markersList[e].openInfoWindow(this.infoWindow)}},getCurPoiName:function(e){if(e==undefined){e=this.curPointIndex}if(e==0){return this.startName}else{if(e==this.endIndex){return this.endName}else{return this.tpName[e-1]}}},each:function(jf,T){for(var je=0,e=jf.length;je<e;je++){T(je,jf[je])}}});ev.extend(hS.prototype,{_asyncSearch:function(jf,e,je){var T=this;var i=this.getUrl(jf,e,je);T.goURI("web",i)},routeCall:function(jf,e,je){var T=this;var i=this.getUrl(jf,e,je);T.goURI("web",i)},setPointParameters:function(je,i){var T=this.opts;var jf="";if(je&&je.latlng&&je.name){var e=je.latlng;jf="latlng:"+e.lat+","+e.lng;jf+="|name:"+je.name}else{var e=je.latlng;jf=e?e.lat+","+e.lng:(je.name?je.name:"")}T[i]=jf},getUrl:function(je,jh,e){this.setPointParameters(je,"origin");this.setPointParameters(jh,"destination");this.opts=ev.extend(this.opts,e);var jf=this.opts;var T=[];var jk="";var jn="";if(typeof(jf.origin)==="undefined"||jf.origin===""){jf.origin=""}var jm={destination:false,mode:false};for(var jg in jf){jk=jg+"="+jf[jg];T.push(jk);if(typeof(jm[jg])!=="undefined"){jm[jg]=true}}this.mode=jf.mode;if(jm.mode===false){var jl="mode="+BMAP_MODE_DRIVING;this.mode=BMAP_MODE_DRIVING;T.push(jl);jm.mode=true}var jj=true;for(var ji in jm){jj=jj&&jm[ji]}if(jj){return T.join("&")}return false},goURI:function(T,i,jf){var e=function(jg){var jh=document.createElement("script");jh.src="http://127.0.0.1:6259/sendintent?callback=send&intent="+encodeURIComponent(jg+"&src=baidu|jsapi#Intent;scheme=bdapp;package=com.baidu.BaiduMap;end");document.body.appendChild(jh)};if(i){var je=aT[T]+i+"&src=baidu|jsapi";if(T==="web"){je+="&output=html"}location.href=je;jf&&jf()}}});');
